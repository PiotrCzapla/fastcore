<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Utility functions used in the fastai library">

<title>Utility functions – fastcore</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-000f0825b9c55ed21d14970d810c14a9.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Utility functions – fastcore">
<meta property="og:description" content="Utility functions used in the fastai library">
<meta property="og:image" content="https://fastcore.fast.ai/03_xtras_files/figure-html/cell-24-output-1.png">
<meta property="og:site_name" content="fastcore">
<meta property="og:image:height" content="50">
<meta property="og:image:width" content="50">
<meta name="twitter:title" content="Utility functions – fastcore">
<meta name="twitter:description" content="Utility functions used in the fastai library">
<meta name="twitter:image" content="https://fastcore.fast.ai/03_xtras_files/figure-html/cell-24-output-1.png">
<meta name="twitter:image-height" content="50">
<meta name="twitter:image-width" content="50">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">fastcore</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/fastai/fastcore"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/fastdotai"> <i class="bi bi-twitter" role="img" aria-label="Fast.ai Twitter">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./xtras.html">Utility functions</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome to fastcore</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tour.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A tour of fastcore</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./test.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Test</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic functionality</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./foundation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Foundation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./xtras.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Utility functions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./parallel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Parallel</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./net.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Network functionality</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./docments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Docments</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./meta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Meta</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./script.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Script - CLI</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./xdg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">XDG</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./style.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Style</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./xml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">XML</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./py2pyi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Create delegated pyi</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./external.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">External modules</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">LLM tools</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#file-functions" id="toc-file-functions" class="nav-link active" data-scroll-target="#file-functions">File Functions</a>
  <ul class="collapse">
  <li><a href="#walk" id="toc-walk" class="nav-link" data-scroll-target="#walk">walk</a></li>
  <li><a href="#exttypes" id="toc-exttypes" class="nav-link" data-scroll-target="#exttypes">exttypes</a></li>
  <li><a href="#globtastic" id="toc-globtastic" class="nav-link" data-scroll-target="#globtastic">globtastic</a></li>
  <li><a href="#pglob" id="toc-pglob" class="nav-link" data-scroll-target="#pglob">pglob</a></li>
  <li><a href="#maybe_open" id="toc-maybe_open" class="nav-link" data-scroll-target="#maybe_open">maybe_open</a></li>
  <li><a href="#mkdir" id="toc-mkdir" class="nav-link" data-scroll-target="#mkdir">mkdir</a></li>
  <li><a href="#image_size" id="toc-image_size" class="nav-link" data-scroll-target="#image_size">image_size</a></li>
  <li><a href="#img_bytes" id="toc-img_bytes" class="nav-link" data-scroll-target="#img_bytes">img_bytes</a></li>
  <li><a href="#detect_mime" id="toc-detect_mime" class="nav-link" data-scroll-target="#detect_mime">detect_mime</a></li>
  <li><a href="#bunzip" id="toc-bunzip" class="nav-link" data-scroll-target="#bunzip">bunzip</a></li>
  <li><a href="#loads" id="toc-loads" class="nav-link" data-scroll-target="#loads">loads</a></li>
  <li><a href="#loads_multi" id="toc-loads_multi" class="nav-link" data-scroll-target="#loads_multi">loads_multi</a></li>
  <li><a href="#dumps" id="toc-dumps" class="nav-link" data-scroll-target="#dumps">dumps</a></li>
  <li><a href="#untar_dir" id="toc-untar_dir" class="nav-link" data-scroll-target="#untar_dir">untar_dir</a></li>
  <li><a href="#repo_details" id="toc-repo_details" class="nav-link" data-scroll-target="#repo_details">repo_details</a></li>
  <li><a href="#shell" id="toc-shell" class="nav-link" data-scroll-target="#shell">shell</a></li>
  <li><a href="#ssh" id="toc-ssh" class="nav-link" data-scroll-target="#ssh">ssh</a></li>
  <li><a href="#rsync_multi" id="toc-rsync_multi" class="nav-link" data-scroll-target="#rsync_multi">rsync_multi</a></li>
  <li><a href="#run" id="toc-run" class="nav-link" data-scroll-target="#run">run</a></li>
  <li><a href="#open_file" id="toc-open_file" class="nav-link" data-scroll-target="#open_file">open_file</a></li>
  <li><a href="#save_pickle" id="toc-save_pickle" class="nav-link" data-scroll-target="#save_pickle">save_pickle</a></li>
  <li><a href="#load_pickle" id="toc-load_pickle" class="nav-link" data-scroll-target="#load_pickle">load_pickle</a></li>
  <li><a href="#parse_env" id="toc-parse_env" class="nav-link" data-scroll-target="#parse_env">parse_env</a></li>
  <li><a href="#expand_wildcards" id="toc-expand_wildcards" class="nav-link" data-scroll-target="#expand_wildcards">expand_wildcards</a></li>
  </ul></li>
  <li><a href="#collections" id="toc-collections" class="nav-link" data-scroll-target="#collections">Collections</a>
  <ul class="collapse">
  <li><a href="#dict2obj" id="toc-dict2obj" class="nav-link" data-scroll-target="#dict2obj">dict2obj</a></li>
  <li><a href="#obj2dict" id="toc-obj2dict" class="nav-link" data-scroll-target="#obj2dict">obj2dict</a></li>
  <li><a href="#repr_dict" id="toc-repr_dict" class="nav-link" data-scroll-target="#repr_dict">repr_dict</a></li>
  <li><a href="#is_listy" id="toc-is_listy" class="nav-link" data-scroll-target="#is_listy">is_listy</a></li>
  <li><a href="#mapped" id="toc-mapped" class="nav-link" data-scroll-target="#mapped">mapped</a></li>
  </ul></li>
  <li><a href="#extensions-to-pathlib.path" id="toc-extensions-to-pathlib.path" class="nav-link" data-scroll-target="#extensions-to-pathlib.path">Extensions to Pathlib.Path</a>
  <ul class="collapse">
  <li><a href="#path.readlines" id="toc-path.readlines" class="nav-link" data-scroll-target="#path.readlines">Path.readlines</a></li>
  <li><a href="#path.read_json" id="toc-path.read_json" class="nav-link" data-scroll-target="#path.read_json">Path.read_json</a></li>
  <li><a href="#path.mk_write" id="toc-path.mk_write" class="nav-link" data-scroll-target="#path.mk_write">Path.mk_write</a></li>
  <li><a href="#path.write_json" id="toc-path.write_json" class="nav-link" data-scroll-target="#path.write_json">Path.write_json</a></li>
  <li><a href="#path.relpath" id="toc-path.relpath" class="nav-link" data-scroll-target="#path.relpath">Path.relpath</a></li>
  <li><a href="#path.ls" id="toc-path.ls" class="nav-link" data-scroll-target="#path.ls">Path.ls</a></li>
  <li><a href="#path.normpath" id="toc-path.normpath" class="nav-link" data-scroll-target="#path.normpath">Path.normpath</a></li>
  <li><a href="#path.__repr__" id="toc-path.__repr__" class="nav-link" data-scroll-target="#path.__repr__">Path.__repr__</a></li>
  <li><a href="#path.delete" id="toc-path.delete" class="nav-link" data-scroll-target="#path.delete">Path.delete</a></li>
  </ul></li>
  <li><a href="#reindexing-collections" id="toc-reindexing-collections" class="nav-link" data-scroll-target="#reindexing-collections">Reindexing Collections</a></li>
  <li><a href="#savereturn-and-save_iter-variants" id="toc-savereturn-and-save_iter-variants" class="nav-link" data-scroll-target="#savereturn-and-save_iter-variants"><code>SaveReturn</code> and <code>save_iter</code> Variants</a>
  <ul class="collapse">
  <li><a href="#savereturn" id="toc-savereturn" class="nav-link" data-scroll-target="#savereturn">SaveReturn</a></li>
  <li><a href="#trim_wraps" id="toc-trim_wraps" class="nav-link" data-scroll-target="#trim_wraps">trim_wraps</a></li>
  <li><a href="#save_iter" id="toc-save_iter" class="nav-link" data-scroll-target="#save_iter">save_iter</a></li>
  <li><a href="#asave_iter" id="toc-asave_iter" class="nav-link" data-scroll-target="#asave_iter">asave_iter</a></li>
  </ul></li>
  <li><a href="#other-helpers" id="toc-other-helpers" class="nav-link" data-scroll-target="#other-helpers">Other Helpers</a>
  <ul class="collapse">
  <li><a href="#unqid" id="toc-unqid" class="nav-link" data-scroll-target="#unqid">unqid</a></li>
  <li><a href="#rtoken_hex" id="toc-rtoken_hex" class="nav-link" data-scroll-target="#rtoken_hex">rtoken_hex</a></li>
  <li><a href="#friendly_name" id="toc-friendly_name" class="nav-link" data-scroll-target="#friendly_name">friendly_name</a></li>
  <li><a href="#n_friendly_names" id="toc-n_friendly_names" class="nav-link" data-scroll-target="#n_friendly_names">n_friendly_names</a></li>
  <li><a href="#exec_eval" id="toc-exec_eval" class="nav-link" data-scroll-target="#exec_eval">exec_eval</a></li>
  <li><a href="#get_source_link" id="toc-get_source_link" class="nav-link" data-scroll-target="#get_source_link">get_source_link</a></li>
  <li><a href="#sparkline" id="toc-sparkline" class="nav-link" data-scroll-target="#sparkline">sparkline</a></li>
  <li><a href="#modify_exception" id="toc-modify_exception" class="nav-link" data-scroll-target="#modify_exception">modify_exception</a></li>
  <li><a href="#round_multiple" id="toc-round_multiple" class="nav-link" data-scroll-target="#round_multiple">round_multiple</a></li>
  <li><a href="#set_num_threads" id="toc-set_num_threads" class="nav-link" data-scroll-target="#set_num_threads">set_num_threads</a></li>
  <li><a href="#join_path_file" id="toc-join_path_file" class="nav-link" data-scroll-target="#join_path_file">join_path_file</a></li>
  <li><a href="#autostart" id="toc-autostart" class="nav-link" data-scroll-target="#autostart">autostart</a></li>
  <li><a href="#stringfmt_names" id="toc-stringfmt_names" class="nav-link" data-scroll-target="#stringfmt_names">stringfmt_names</a></li>
  <li><a href="#partial_format" id="toc-partial_format" class="nav-link" data-scroll-target="#partial_format">partial_format</a></li>
  <li><a href="#truncstr" id="toc-truncstr" class="nav-link" data-scroll-target="#truncstr">truncstr</a></li>
  <li><a href="#utc2local" id="toc-utc2local" class="nav-link" data-scroll-target="#utc2local">utc2local</a></li>
  <li><a href="#local2utc" id="toc-local2utc" class="nav-link" data-scroll-target="#local2utc">local2utc</a></li>
  <li><a href="#trace" id="toc-trace" class="nav-link" data-scroll-target="#trace">trace</a></li>
  <li><a href="#modified_env" id="toc-modified_env" class="nav-link" data-scroll-target="#modified_env">modified_env</a></li>
  <li><a href="#shufflish" id="toc-shufflish" class="nav-link" data-scroll-target="#shufflish">shufflish</a></li>
  <li><a href="#console_help" id="toc-console_help" class="nav-link" data-scroll-target="#console_help">console_help</a></li>
  <li><a href="#hl_md" id="toc-hl_md" class="nav-link" data-scroll-target="#hl_md">hl_md</a></li>
  <li><a href="#type2str" id="toc-type2str" class="nav-link" data-scroll-target="#type2str">type2str</a></li>
  <li><a href="#dataclass_src" id="toc-dataclass_src" class="nav-link" data-scroll-target="#dataclass_src">dataclass_src</a></li>
  <li><a href="#unset" id="toc-unset" class="nav-link" data-scroll-target="#unset">Unset</a></li>
  <li><a href="#nullable_dc" id="toc-nullable_dc" class="nav-link" data-scroll-target="#nullable_dc">nullable_dc</a></li>
  <li><a href="#make_nullable" id="toc-make_nullable" class="nav-link" data-scroll-target="#make_nullable">make_nullable</a></li>
  <li><a href="#flexiclass" id="toc-flexiclass" class="nav-link" data-scroll-target="#flexiclass">flexiclass</a></li>
  <li><a href="#asdict" id="toc-asdict" class="nav-link" data-scroll-target="#asdict">asdict</a></li>
  <li><a href="#vars_pub" id="toc-vars_pub" class="nav-link" data-scroll-target="#vars_pub">vars_pub</a></li>
  <li><a href="#is_typeddict" id="toc-is_typeddict" class="nav-link" data-scroll-target="#is_typeddict">is_typeddict</a></li>
  <li><a href="#is_namedtuple" id="toc-is_namedtuple" class="nav-link" data-scroll-target="#is_namedtuple">is_namedtuple</a></li>
  <li><a href="#cachediter" id="toc-cachediter" class="nav-link" data-scroll-target="#cachediter">CachedIter</a></li>
  <li><a href="#cachedawaitable" id="toc-cachedawaitable" class="nav-link" data-scroll-target="#cachedawaitable">CachedAwaitable</a></li>
  <li><a href="#reawaitable" id="toc-reawaitable" class="nav-link" data-scroll-target="#reawaitable">reawaitable</a></li>
  <li><a href="#flexicache" id="toc-flexicache" class="nav-link" data-scroll-target="#flexicache">flexicache</a></li>
  <li><a href="#time_policy" id="toc-time_policy" class="nav-link" data-scroll-target="#time_policy">time_policy</a></li>
  <li><a href="#mtime_policy" id="toc-mtime_policy" class="nav-link" data-scroll-target="#mtime_policy">mtime_policy</a></li>
  <li><a href="#timed_cache" id="toc-timed_cache" class="nav-link" data-scroll-target="#timed_cache">timed_cache</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/AnswerDotAI/fastcore/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div><div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="xtras.html.md"><i class="bi bi-file-code"></i>CommonMark</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Utility functions</h1>
</div>

<div>
  <div class="description">
    Utility functions used in the fastai library
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="file-functions" class="level2">
<h2 class="anchored" data-anchor-id="file-functions">File Functions</h2>
<p>Utilities (other than extensions to Pathlib.Path) for dealing with IO.</p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L36" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="walk" class="level3">
<h3 class="anchored" data-anchor-id="walk">walk</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> walk(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    path:Path \<span class="op">|</span> <span class="bu">str</span>, <span class="co"># path to start searching</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    symlinks:<span class="bu">bool</span><span class="op">=</span><span class="va">True</span>, <span class="co"># follow symlinks?</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    keep_file:<span class="bu">callable</span><span class="op">=&lt;</span>function ret_true at <span class="bn">0x7f717bfc96c0</span><span class="op">&gt;</span>, <span class="co"># function that returns True for wanted files</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    keep_folder:<span class="bu">callable</span><span class="op">=&lt;</span>function ret_true at <span class="bn">0x7f717bfc96c0</span><span class="op">&gt;</span>, <span class="co"># function that returns True for folders to enter</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    skip_folder:<span class="bu">callable</span><span class="op">=&lt;</span>function ret_false at <span class="bn">0x7f717bfc9760</span><span class="op">&gt;</span>, <span class="co"># function that returns True for folders to skip</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    func:<span class="bu">callable</span><span class="op">=&lt;</span>function join at <span class="bn">0x7f717c718cc0</span><span class="op">&gt;</span>, <span class="co"># function to apply to each matched file</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    ret_folders:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>, <span class="co"># return folders, not just files</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    sort:<span class="bu">bool</span><span class="op">=</span><span class="va">True</span>, <span class="co"># sort files by name within each folder</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Generator version of <code>os.walk</code>, using functions to filter files and folders</em></p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L72" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="exttypes" class="level3">
<h3 class="anchored" data-anchor-id="exttypes">exttypes</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> exttypes(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    types</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Get exts for comma-separated or list <code>typ</code>; if not found in list, return list with just <code>types</code>.</em> Supported: py, js, java, c, cpp, rb, r, ex, sh, web, doc, cfg</p>
<div id="1c24d2e0" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(exttypes(<span class="st">'py,doc'</span>))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(exttypes(<span class="st">'zig,txt'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>['ipynb', 'py', 'md', 'rst']
['zig', 'txt']</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L79" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="globtastic" class="level3">
<h3 class="anchored" data-anchor-id="globtastic">globtastic</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> globtastic(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    path:Path \<span class="op">|</span> <span class="bu">str</span><span class="op">=</span><span class="st">'.'</span>, <span class="co"># path to start searching</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    recursive:<span class="bu">bool</span><span class="op">=</span><span class="va">True</span>, <span class="co"># search subfolders</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    symlinks:<span class="bu">bool</span><span class="op">=</span><span class="va">True</span>, <span class="co"># follow symlinks?</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    file_glob:<span class="bu">str</span><span class="op">=</span><span class="va">None</span>, <span class="co"># Only include files matching glob</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    file_re:<span class="bu">str</span><span class="op">=</span><span class="va">None</span>, <span class="co"># Only include files matching regex</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    folder_re:<span class="bu">str</span><span class="op">=</span><span class="va">None</span>, <span class="co"># Only enter folders matching regex</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    skip_file_glob:<span class="bu">str</span><span class="op">=</span><span class="va">None</span>, <span class="co"># Skip files matching glob</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    skip_file_re:<span class="bu">str</span><span class="op">=</span><span class="va">None</span>, <span class="co"># Skip files matching regex</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    skip_folder_re:<span class="bu">str</span><span class="op">=</span><span class="va">None</span>, <span class="co"># Skip folders matching regex,</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    func:<span class="bu">callable</span><span class="op">=&lt;</span>function join at <span class="bn">0x7f717c718cc0</span><span class="op">&gt;</span>, <span class="co"># function to apply to each matched file</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    ret_folders:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>, <span class="co"># return folders, not just files</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    sort:<span class="bu">bool</span><span class="op">=</span><span class="va">True</span>, <span class="co"># sort files by name within each folder</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    types:<span class="bu">str</span> \<span class="op">|</span> <span class="bu">list</span><span class="op">=</span><span class="va">None</span>, <span class="co"># list or comma-separated str of ext types from: py, js, java, c, cpp, rb, r, ex, sh, web, doc, cfg</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    exts:<span class="bu">str</span> \<span class="op">|</span> <span class="bu">list</span><span class="op">=</span><span class="va">None</span>, <span class="co"># list or comma-separated str of exts to include</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>)<span class="op">-&gt;</span>L: <span class="co"># Paths to matched files</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>A more powerful <code>glob</code>, including regex matches, symlink handling, and skip parameters</em></p>
<div id="91c9e1df" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>globtastic(<span class="st">'.'</span>, skip_folder_re<span class="op">=</span><span class="st">'^[_.]'</span>, folder_re<span class="op">=</span><span class="st">'core'</span>, file_glob<span class="op">=</span><span class="st">'*.*py*'</span>, file_re<span class="op">=</span><span class="st">'c'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>['./fastcore/basics.py', './fastcore/dispatch.py', './fastcore/docments.py', './fastcore/docscrape.py', './fastcore/script.py']</code></pre>
</div>
</div>
<div id="93a1c35d" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>globtastic(skip_folder_re<span class="op">=</span><span class="st">'^[_.]'</span>, folder_re<span class="op">=</span><span class="st">'core'</span>, types<span class="op">=</span><span class="st">'py'</span>, file_re<span class="op">=</span><span class="st">'c'</span>, skip_file_re<span class="op">=</span><span class="st">'^_'</span>, sort<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>['./fastcore/all.py', './fastcore/ansi.py', './fastcore/basics.py', './fastcore/dispatch.py', './fastcore/docments.py', './fastcore/docscrape.py', './fastcore/foundation.py', './fastcore/imghdr.py', './fastcore/imports.py', './fastcore/meta.py', './fastcore/nb_imports.py', './fastcore/net.py', './fastcore/parallel.py', './fastcore/py2pyi.py', './fastcore/script.py', './fastcore/shutil.py', './fastcore/style.py', './fastcore/test.py', './fastcore/tools.py', './fastcore/transform.py', './fastcore/utils.py', './fastcore/xdg.py', './fastcore/xml.py', './fastcore/xtras.py']</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L119" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="pglob" class="level3">
<h3 class="anchored" data-anchor-id="pglob">pglob</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> pglob(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    path:Path \<span class="op">|</span> <span class="bu">str</span><span class="op">=</span><span class="st">'.'</span>, <span class="co"># path to start searching</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    func:<span class="bu">callable</span><span class="op">=&lt;</span><span class="kw">class</span> <span class="st">'pathlib.Path'</span><span class="op">&gt;</span>, <span class="co"># function to apply to each matched file</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    recursive:<span class="bu">bool</span><span class="op">=</span><span class="va">True</span>, symlinks:<span class="bu">bool</span><span class="op">=</span><span class="va">True</span>, file_glob:<span class="bu">str</span><span class="op">=</span><span class="va">None</span>, file_re:<span class="bu">str</span><span class="op">=</span><span class="va">None</span>, folder_re:<span class="bu">str</span><span class="op">=</span><span class="va">None</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    skip_file_glob:<span class="bu">str</span><span class="op">=</span><span class="va">None</span>, skip_file_re:<span class="bu">str</span><span class="op">=</span><span class="va">None</span>, skip_folder_re:<span class="bu">str</span><span class="op">=</span><span class="va">None</span>, ret_folders:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>, sort:<span class="bu">bool</span><span class="op">=</span><span class="va">True</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    types:<span class="bu">str</span> \<span class="op">|</span> <span class="bu">list</span><span class="op">=</span><span class="va">None</span>, exts:<span class="bu">str</span> \<span class="op">|</span> <span class="bu">list</span><span class="op">=</span><span class="va">None</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>)<span class="op">-&gt;</span>L: <span class="co"># Paths to matched files</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Shortcut for <code>globtastic(..., call=Path)</code></em></p>
<div id="1ac68228" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>pglob(<span class="st">'..'</span>, skip_folder_re<span class="op">=</span><span class="st">'^[_.]'</span>, types<span class="op">=</span><span class="st">'doc'</span>, skip_file_re<span class="op">=</span><span class="st">'^_'</span>)[:<span class="dv">6</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>[Path('../CHANGELOG.md'), Path('../CODE_OF_CONDUCT.md'), Path('../CONTRIBUTING.md'), Path('../README.md')]</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L129" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="maybe_open" class="level3">
<h3 class="anchored" data-anchor-id="maybe_open">maybe_open</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> maybe_open(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    f, mode:<span class="bu">str</span><span class="op">=</span><span class="st">'r'</span>, kwargs:VAR_KEYWORD</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Context manager: open <code>f</code> if it is a path (and close on exit)</em></p>
<p>This is useful for functions where you want to accept a path <em>or</em> file. <a href="https://fastcore.fast.ai/xtras.html#maybe_open"><code>maybe_open</code></a> will not close your file handle if you pass one in.</p>
<div id="27e4f70d" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _f(fn):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> maybe_open(fn) <span class="im">as</span> f: <span class="cf">return</span> f.encoding</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>fname <span class="op">=</span> <span class="st">'00_test.ipynb'</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>sys_encoding <span class="op">=</span> <span class="st">'cp1252'</span> <span class="cf">if</span> sys.platform <span class="op">==</span> <span class="st">'win32'</span> <span class="cf">else</span> <span class="st">'utf-8'</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>test_eq(_f(fname).lower(), sys_encoding)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(fname) <span class="im">as</span> fh: test_eq(_f(fh).lower(), sys_encoding)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>For example, we can use this to reimplement <a href="https://docs.python.org/3/library/imghdr.html#imghdr.what"><code>imghdr.what</code></a> from the Python standard library, which is <a href="https://github.com/python/cpython/blob/3.9/Lib/imghdr.py#L11">written in Python 3.9</a> as:</p>
<div id="dbaa6878" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastcore <span class="im">import</span> imghdr</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="50e0c494" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> what(<span class="bu">file</span>, h<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    f <span class="op">=</span> <span class="va">None</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> h <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">isinstance</span>(<span class="bu">file</span>, (<span class="bu">str</span>,os.PathLike)):</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                f <span class="op">=</span> <span class="bu">open</span>(<span class="bu">file</span>, <span class="st">'rb'</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                h <span class="op">=</span> f.read(<span class="dv">32</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>                location <span class="op">=</span> <span class="bu">file</span>.tell()</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>                h <span class="op">=</span> <span class="bu">file</span>.read(<span class="dv">32</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>                <span class="bu">file</span>.seek(location)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> tf <span class="kw">in</span> imghdr.tests:</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>            res <span class="op">=</span> tf(h, f)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> res: <span class="cf">return</span> res</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">finally</span>:</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> f: f.close()</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Here’s an example of the use of this function:</p>
<div id="1a301e49" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>fname <span class="op">=</span> <span class="st">'images/puppy.jpg'</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>what(fname)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>'jpeg'</code></pre>
</div>
</div>
<p>With <a href="https://fastcore.fast.ai/xtras.html#maybe_open"><code>maybe_open</code></a>, <code>Self</code>, and <a href="https://fastcore.fast.ai/foundation.html#l.map_first"><code>L.map_first</code></a>, we can rewrite this in a much more concise and (in our opinion) clear way:</p>
<div id="2c1557f2" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> what(<span class="bu">file</span>, h<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> h <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> maybe_open(<span class="bu">file</span>, <span class="st">'rb'</span>) <span class="im">as</span> f: h <span class="op">=</span> f.peek(<span class="dv">32</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> L(imghdr.tests).map_first(Self(h,<span class="bu">file</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>…and we can check that it still works:</p>
<div id="a443b319" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>test_eq(what(fname), <span class="st">'jpeg'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>…along with the version passing a file handle:</p>
<div id="05871c81" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(fname,<span class="st">'rb'</span>) <span class="im">as</span> f: test_eq(what(f), <span class="st">'jpeg'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>…along with the <code>h</code> parameter version:</p>
<div id="8377f8af" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(fname,<span class="st">'rb'</span>) <span class="im">as</span> f: test_eq(what(<span class="va">None</span>, h<span class="op">=</span>f.read(<span class="dv">32</span>)), <span class="st">'jpeg'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L136" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="mkdir" class="level3">
<h3 class="anchored" data-anchor-id="mkdir">mkdir</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mkdir(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    path, exist_ok:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>, parents:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>, overwrite:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>, kwargs:VAR_KEYWORD</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Creates and returns a directory defined by <code>path</code>, optionally removing previous existing directory if <code>overwrite</code> is <code>True</code></em></p>
<div id="7ca6a87d" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> tempfile.TemporaryDirectory() <span class="im">as</span> d:</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    path <span class="op">=</span> Path(os.path.join(d, <span class="st">'new_dir'</span>))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    new_dir <span class="op">=</span> mkdir(path)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> new_dir.exists()</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    test_eq(new_dir, path)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># test overwrite</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(new_dir<span class="op">/</span><span class="st">'test.txt'</span>, <span class="st">'w'</span>) <span class="im">as</span> f: f.writelines(<span class="st">'test'</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(<span class="bu">list</span>(walk(new_dir))), <span class="dv">1</span>) <span class="co"># assert file is present</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    new_dir <span class="op">=</span> mkdir(new_dir, overwrite<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(<span class="bu">list</span>(walk(new_dir))), <span class="dv">0</span>) <span class="co"># assert file was deleted</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L145" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="image_size" class="level3">
<h3 class="anchored" data-anchor-id="image_size">image_size</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> image_size(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    fn</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Tuple of (w,h) for png, gif, or jpg; <code>None</code> otherwise</em></p>
<div id="2e9a1760" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>test_eq(image_size(fname), (<span class="dv">1200</span>,<span class="dv">803</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="c7dc50c4" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Image <span class="im">as</span> IPImage</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="1f3c35e2" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> Image.new(<span class="st">'RGB'</span>, (<span class="dv">50</span>, <span class="dv">50</span>), color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>img</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="03_xtras_files/figure-html/cell-24-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L170" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="img_bytes" class="level3">
<h3 class="anchored" data-anchor-id="img_bytes">img_bytes</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> img_bytes(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    img, fmt:<span class="bu">str</span><span class="op">=</span><span class="st">'PNG'</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="3d8d71ae" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ib <span class="op">=</span> img_bytes(img)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>IPImage(ib)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="03_xtras_files/figure-html/cell-26-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L194" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="detect_mime" class="level3">
<h3 class="anchored" data-anchor-id="detect_mime">detect_mime</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> detect_mime(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    data</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Get the MIME type for bytes <code>data</code>, covering common PDF, audio, video, and image types</em></p>
<div id="95c46f5a" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>detect_mime(ib)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>'image/png'</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L203" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="bunzip" class="level3">
<h3 class="anchored" data-anchor-id="bunzip">bunzip</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bunzip(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    fn</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>bunzip <code>fn</code>, raising exception if output already exists</em></p>
<div id="edd12907" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> Path(<span class="st">'files/test.txt'</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> f.exists(): f.unlink()</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>bunzip(<span class="st">'files/test.txt.bz2'</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> f.<span class="bu">open</span>().readlines()</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(t),<span class="dv">1</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>test_eq(t[<span class="dv">0</span>], <span class="st">'test</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>f.unlink()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L214" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="loads" class="level3">
<h3 class="anchored" data-anchor-id="loads">loads</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> loads(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    s, kw:VAR_KEYWORD</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Same as <code>json.loads</code>, but handles <code>None</code></em></p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L222" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="loads_multi" class="level3">
<h3 class="anchored" data-anchor-id="loads_multi">loads_multi</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> loads_multi(</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    s:<span class="bu">str</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Generator of &gt;=0 decoded json dicts, possibly with non-json ignored text at start and end</em></p>
<div id="2baed86c" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>tst <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="st"># ignored</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="st">{ "a":1 }</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="st">hello</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="st">{</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="st">"b":2</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(loads_multi(tst)), [{<span class="st">'a'</span>: <span class="dv">1</span>}, {<span class="st">'b'</span>: <span class="dv">2</span>}])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L234" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="dumps" class="level3">
<h3 class="anchored" data-anchor-id="dumps">dumps</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dumps(</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    obj, kw:VAR_KEYWORD</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Same as <code>json.dumps</code>, but uses <code>ujson</code> if available</em></p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L249" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="untar_dir" class="level3">
<h3 class="anchored" data-anchor-id="untar_dir">untar_dir</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> untar_dir(</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    fname, dest, rename:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>, overwrite:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>untar <code>file</code> into <code>dest</code>, creating a directory if the root contains more than one item</em></p>
<div id="39d4866a" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_untar(foldername, rename<span class="op">=</span><span class="va">False</span>, <span class="op">**</span>kwargs):</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> tempfile.TemporaryDirectory() <span class="im">as</span> d:</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>        nm <span class="op">=</span> os.path.join(d, <span class="st">'a'</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>        shutil.make_archive(nm, <span class="st">'gztar'</span>, <span class="op">**</span>kwargs)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> tempfile.TemporaryDirectory() <span class="im">as</span> d2:</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>            d2 <span class="op">=</span> Path(d2)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>            untar_dir(nm<span class="op">+</span><span class="st">'.tar.gz'</span>, d2, rename<span class="op">=</span>rename)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>            test_eq(d2.ls(), [d2<span class="op">/</span>foldername])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>If the contents of <code>fname</code> contain just one file or directory, it is placed directly in <code>dest</code>:</p>
<div id="88501e83" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using `base_dir` in `make_archive` results in `images` directory included in file names</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>test_untar(<span class="st">'images'</span>, base_dir<span class="op">=</span><span class="st">'images'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>If <code>rename</code> then the directory created is named based on the archive, without extension:</p>
<div id="72e2d7a2" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>test_untar(<span class="st">'a'</span>, base_dir<span class="op">=</span><span class="st">'images'</span>, rename<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>If the contents of <code>fname</code> contain multiple files and directories, a new folder in <code>dest</code> is created with the same name as <code>fname</code> (but without extension):</p>
<div id="16235244" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using `root_dir` in `make_archive` results in `images` directory *not* included in file names</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>test_untar(<span class="st">'a'</span>, root_dir<span class="op">=</span><span class="st">'images'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L268" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="repo_details" class="level3">
<h3 class="anchored" data-anchor-id="repo_details">repo_details</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> repo_details(</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    url</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Tuple of <code>owner,name</code> from ssh or https git repo <code>url</code></em></p>
<div id="20f50fcb" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>test_eq(repo_details(<span class="st">'https://github.com/fastai/fastai.git'</span>), [<span class="st">'fastai'</span>, <span class="st">'fastai'</span>])</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>test_eq(repo_details(<span class="st">'git@github.com:fastai/nbdev.git</span><span class="ch">\n</span><span class="st">'</span>), [<span class="st">'fastai'</span>, <span class="st">'nbdev'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L275" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="shell" class="level3">
<h3 class="anchored" data-anchor-id="shell">shell</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> shell(</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    args:VAR_POSITIONAL, kwargs:VAR_KEYWORD</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Shortcut for <code>subprocess.run(shell=True)</code></em></p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L281" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="ssh" class="level3">
<h3 class="anchored" data-anchor-id="ssh">ssh</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ssh(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    host, args:<span class="bu">str</span><span class="op">=</span><span class="st">''</span>, user:<span class="bu">str</span><span class="op">=</span><span class="st">'ubuntu'</span>, sock:NoneType<span class="op">=</span><span class="va">None</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Run SSH command with given arguments</em></p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L287" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="rsync_multi" class="level3">
<h3 class="anchored" data-anchor-id="rsync_multi">rsync_multi</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rsync_multi(</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    ip, files, user:<span class="bu">str</span><span class="op">=</span><span class="st">'ubuntu'</span>, persist:<span class="bu">str</span><span class="op">=</span><span class="st">'5m'</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Transfer multiple files with rename using persistent SSH connection</em></p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L294" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="run" class="level3">
<h3 class="anchored" data-anchor-id="run">run</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run(</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    cmd, rest:VAR_POSITIONAL, same_in_win:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>, ignore_ex:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>, as_bytes:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>, stderr:<span class="bu">bool</span><span class="op">=</span><span class="va">True</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Pass <code>cmd</code> (splitting with <code>shlex</code> if string) to <code>subprocess.run</code>; return <code>stdout</code>; raise <code>IOError</code> if fails</em></p>
<p>You can pass a string (which will be split based on standard shell rules), a list, or pass args directly:</p>
<div id="8bcce474" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>run(<span class="st">'echo'</span>, same_in_win<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>run(<span class="st">'pip'</span>, <span class="st">'--version'</span>, same_in_win<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>run([<span class="st">'pip'</span>, <span class="st">'--version'</span>], same_in_win<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>'pip 25.3 from /Users/jhoward/aai-ws/.venv/lib/python3.12/site-packages/pip (python 3.12)'</code></pre>
</div>
</div>
<div id="51a8302a" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> sys.platform <span class="op">==</span> <span class="st">'win32'</span>:</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="st">'ipynb'</span> <span class="kw">in</span> run(<span class="st">'cmd /c dir /p'</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="st">'ipynb'</span> <span class="kw">in</span> run([<span class="st">'cmd'</span>, <span class="st">'/c'</span>, <span class="st">'dir'</span>, <span class="st">'/p'</span>])</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="st">'ipynb'</span> <span class="kw">in</span> run(<span class="st">'cmd'</span>, <span class="st">'/c'</span>, <span class="st">'dir'</span>,  <span class="st">'/p'</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="st">'ipynb'</span> <span class="kw">in</span> run(<span class="st">'ls -ls'</span>)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="st">'ipynb'</span> <span class="kw">in</span> run([<span class="st">'ls'</span>, <span class="st">'-l'</span>])</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="st">'ipynb'</span> <span class="kw">in</span> run(<span class="st">'ls'</span>, <span class="st">'-l'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Some commands fail in non-error situations, like <code>grep</code>. Use <code>ignore_ex</code> in those cases, which will return a tuple of stdout and returncode:</p>
<div id="6567205d" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> sys.platform <span class="op">==</span> <span class="st">'win32'</span>:</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    test_eq(run(<span class="st">'cmd /c findstr asdfds 00_test.ipynb'</span>, ignore_ex<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>], <span class="dv">1</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    test_eq(run(<span class="st">'grep asdfds 00_test.ipynb'</span>, ignore_ex<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>], <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><a href="https://fastcore.fast.ai/xtras.html#run"><code>run</code></a> automatically decodes returned bytes to a <code>str</code>. Use <code>as_bytes</code> to skip that:</p>
<div id="2a41d502" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> sys.platform <span class="op">==</span> <span class="st">'win32'</span>:</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    test_eq(run(<span class="st">'cmd /c echo hi'</span>), <span class="st">'hi'</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    test_eq(run(<span class="st">'echo hi'</span>, as_bytes<span class="op">=</span><span class="va">True</span>), <span class="st">b'hi</span><span class="ch">\n</span><span class="st">'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L318" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="open_file" class="level3">
<h3 class="anchored" data-anchor-id="open_file">open_file</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> open_file(</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    fn, mode:<span class="bu">str</span><span class="op">=</span><span class="st">'r'</span>, kwargs:VAR_KEYWORD</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Open a file, with optional compression if gz or bz2 suffix</em></p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L329" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="save_pickle" class="level3">
<h3 class="anchored" data-anchor-id="save_pickle">save_pickle</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_pickle(</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    fn, o</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Save a pickle file, to a file name or opened file</em></p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L335" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="load_pickle" class="level3">
<h3 class="anchored" data-anchor-id="load_pickle">load_pickle</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_pickle(</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    fn</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Load a pickle file from a file name or opened file</em></p>
<div id="59d72612" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> suf <span class="kw">in</span> <span class="st">'.pkl'</span>,<span class="st">'.bz2'</span>,<span class="st">'.gz'</span>:</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># delete=False is added for Windows</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># https://stackoverflow.com/questions/23212435/permission-denied-to-write-to-my-temporary-file</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> tempfile.NamedTemporaryFile(suffix<span class="op">=</span>suf, delete<span class="op">=</span><span class="va">False</span>) <span class="im">as</span> f:</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>        fn <span class="op">=</span> Path(f.name)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>        save_pickle(fn, <span class="st">'t'</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> load_pickle(fn)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    f.close()</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    test_eq(t,<span class="st">'t'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L341" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="parse_env" class="level3">
<h3 class="anchored" data-anchor-id="parse_env">parse_env</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> parse_env(</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    s:<span class="bu">str</span><span class="op">=</span><span class="va">None</span>, fn:Union[<span class="bu">str</span>, Path]<span class="op">=</span><span class="va">None</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>)<span class="op">-&gt;</span><span class="bu">dict</span>:</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Parse a shell-style environment string or file</em></p>
<div id="4e176024" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>testf <span class="op">=</span> <span class="st">"""# comment</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="st">   # another comment</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="st"> export FOO="bar#baz"</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="st">BAR=thing # comment "ok"</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="st">  baz='thong'</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="st">QUX=quux</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="st">export ZAP = "zip" # more comments</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="st">   FOOBAR = 42   # trailing space and comment"""</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>exp <span class="op">=</span> <span class="bu">dict</span>(FOO<span class="op">=</span><span class="st">'bar#baz'</span>, BAR<span class="op">=</span><span class="st">'thing'</span>, baz<span class="op">=</span><span class="st">'thong'</span>, QUX<span class="op">=</span><span class="st">'quux'</span>, ZAP<span class="op">=</span><span class="st">'zip'</span>, FOOBAR<span class="op">=</span><span class="st">'42'</span>)</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>test_eq(parse_env(testf),  exp)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L352" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="expand_wildcards" class="level3">
<h3 class="anchored" data-anchor-id="expand_wildcards">expand_wildcards</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> expand_wildcards(</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    code</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Expand all wildcard imports in the given code string.</em></p>
<div id="3c593d73" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>inp <span class="op">=</span> <span class="st">"""from math import *</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="st">from os import *</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="st">from random import *</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="st">def func(): return sin(pi) + path.join('a', 'b') + randint(1, 10)"""</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>exp <span class="op">=</span> <span class="st">"""from math import pi, sin</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="st">from os import path</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="st">from random import randint</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="st">def func(): return sin(pi) + path.join('a', 'b') + randint(1, 10)"""</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>test_eq(expand_wildcards(inp), exp)</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>inp <span class="op">=</span> <span class="st">"""from itertools import *</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="st">def func(): pass"""</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>test_eq(expand_wildcards(inp), inp)</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>inp <span class="op">=</span> <span class="st">"""def outer():</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a><span class="st">    from math import *</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a><span class="st">    def inner():</span></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a><span class="st">        from os import *</span></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a><span class="st">        return sin(pi) + path.join('a', 'b')"""</span></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>exp <span class="op">=</span> <span class="st">"""def outer():</span></span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a><span class="st">    from math import pi, sin</span></span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a><span class="st">    def inner():</span></span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a><span class="st">        from os import path</span></span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a><span class="st">        return sin(pi) + path.join('a', 'b')"""</span></span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>test_eq(expand_wildcards(inp), exp)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="collections" class="level2">
<h2 class="anchored" data-anchor-id="collections">Collections</h2>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L386" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="dict2obj" class="level3">
<h3 class="anchored" data-anchor-id="dict2obj">dict2obj</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dict2obj(</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    d:NoneType<span class="op">=</span><span class="va">None</span>, list_func:_L_Meta<span class="op">=&lt;</span><span class="kw">class</span> <span class="st">'fastcore.foundation.L'</span><span class="op">&gt;</span>,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    dict_func:<span class="bu">type</span><span class="op">=&lt;</span><span class="kw">class</span> <span class="st">'fastcore.basics.AttrDict'</span><span class="op">&gt;</span>, kwargs:VAR_KEYWORD</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Convert (possibly nested) dicts (or lists of dicts) to <a href="https://fastcore.fast.ai/basics.html#attrdict"><code>AttrDict</code></a></em></p>
<p>This is a convenience to give you “dotted” access to (possibly nested) dictionaries, e.g:</p>
<div id="f510433e" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>d1 <span class="op">=</span> <span class="bu">dict</span>(a<span class="op">=</span><span class="dv">1</span>, b<span class="op">=</span><span class="bu">dict</span>(c<span class="op">=</span><span class="dv">2</span>,d<span class="op">=</span><span class="dv">3</span>))</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>d2 <span class="op">=</span> dict2obj(d1)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>test_eq(d2.b.c, <span class="dv">2</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>test_eq(d2.b[<span class="st">'c'</span>], <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>kwargs can also be used:</p>
<div id="c6d49262" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>d3 <span class="op">=</span> dict2obj(a<span class="op">=</span><span class="dv">1</span>, b<span class="op">=</span><span class="bu">dict</span>(c<span class="op">=</span><span class="dv">2</span>,d<span class="op">=</span><span class="dv">3</span>))</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>test_eq(d3.b.c, <span class="dv">2</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>test_eq(d3.b[<span class="st">'c'</span>], <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>It can also be used on lists of dicts.</p>
<div id="90445bc3" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>_list_of_dicts <span class="op">=</span> [d1, d1]</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>ds <span class="op">=</span> dict2obj(_list_of_dicts)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>test_eq(ds[<span class="dv">0</span>].b.c, <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L394" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="obj2dict" class="level3">
<h3 class="anchored" data-anchor-id="obj2dict">obj2dict</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> obj2dict(</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    d</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Convert (possibly nested) AttrDicts (or lists of AttrDicts) to <code>dict</code></em></p>
<p><a href="https://fastcore.fast.ai/xtras.html#obj2dict"><code>obj2dict</code></a> can be used to reverse what is done by <a href="https://fastcore.fast.ai/xtras.html#dict2obj"><code>dict2obj</code></a>:</p>
<div id="5118055b" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>test_eq(obj2dict(d2), d1)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>test_eq(obj2dict(ds), _list_of_dicts)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L409" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="repr_dict" class="level3">
<h3 class="anchored" data-anchor-id="repr_dict">repr_dict</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> repr_dict(</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    d</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Print nested dicts and lists, such as returned by <a href="https://fastcore.fast.ai/xtras.html#dict2obj"><code>dict2obj</code></a></em></p>
<div id="6d4f972b" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(repr_dict(d2))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>- a: 1
- b: 
  - c: 2
  - d: 3</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L414" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="is_listy" class="level3">
<h3 class="anchored" data-anchor-id="is_listy">is_listy</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_listy(</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    x</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em><code>isinstance(x, (tuple,list,L,slice,Generator))</code></em></p>
<div id="fb1d1c14" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> is_listy((<span class="dv">1</span>,))</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> is_listy([<span class="dv">1</span>])</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> is_listy(L([<span class="dv">1</span>]))</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> is_listy(<span class="bu">slice</span>(<span class="dv">2</span>))</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="kw">not</span> is_listy(array([<span class="dv">1</span>]))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L419" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="mapped" class="level3">
<h3 class="anchored" data-anchor-id="mapped">mapped</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mapped(</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    f, it</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>map <code>f</code> over <code>it</code>, unless it’s not listy, in which case return <code>f(it)</code></em></p>
<div id="ca6571e1" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _f(x,a<span class="op">=</span><span class="dv">1</span>): <span class="cf">return</span> x<span class="op">-</span>a</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>test_eq(mapped(_f,<span class="dv">1</span>),<span class="dv">0</span>)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>test_eq(mapped(_f,[<span class="dv">1</span>,<span class="dv">2</span>]),[<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>test_eq(mapped(_f,(<span class="dv">1</span>,)),(<span class="dv">0</span>,))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="extensions-to-pathlib.path" class="level2">
<h2 class="anchored" data-anchor-id="extensions-to-pathlib.path">Extensions to Pathlib.Path</h2>
<p>The following methods are added to the standard python libary <a href="https://docs.python.org/3/library/pathlib.html#basic-use">Pathlib.Path</a>.</p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L425" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="path.readlines" class="level3">
<h3 class="anchored" data-anchor-id="path.readlines">Path.readlines</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> readlines(</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    hint:<span class="bu">int</span><span class="op">=-</span><span class="dv">1</span>, encoding:<span class="bu">str</span><span class="op">=</span><span class="st">'utf8'</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Read the content of <code>self</code></em></p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L431" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="path.read_json" class="level3">
<h3 class="anchored" data-anchor-id="path.read_json">Path.read_json</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_json(</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    encoding:NoneType<span class="op">=</span><span class="va">None</span>, errors:NoneType<span class="op">=</span><span class="va">None</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Same as <code>read_text</code> followed by <a href="https://fastcore.fast.ai/xtras.html#loads"><code>loads</code></a></em></p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L437" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="path.mk_write" class="level3">
<h3 class="anchored" data-anchor-id="path.mk_write">Path.mk_write</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mk_write(</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>    data, encoding:NoneType<span class="op">=</span><span class="va">None</span>, errors:NoneType<span class="op">=</span><span class="va">None</span>, mode:<span class="bu">int</span><span class="op">=</span><span class="dv">511</span>, uid:<span class="bu">int</span><span class="op">=-</span><span class="dv">1</span>, gid:<span class="bu">int</span><span class="op">=-</span><span class="dv">1</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Make all parent dirs of <code>self</code>, and write <code>data</code></em></p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L445" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="path.write_json" class="level3">
<h3 class="anchored" data-anchor-id="path.write_json">Path.write_json</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> write_json(</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>    data, encoding:NoneType<span class="op">=</span><span class="va">None</span>, errors:NoneType<span class="op">=</span><span class="va">None</span>, mode:<span class="bu">int</span><span class="op">=</span><span class="dv">511</span>, uid:<span class="bu">int</span><span class="op">=-</span><span class="dv">1</span>, gid:<span class="bu">int</span><span class="op">=-</span><span class="dv">1</span>, kw:VAR_KEYWORD</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Same as <a href="https://fastcore.fast.ai/xtras.html#dumps"><code>dumps</code></a>followed by <code>mk_write</code></em></p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L451" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="path.relpath" class="level3">
<h3 class="anchored" data-anchor-id="path.relpath">Path.relpath</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> relpath(</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    start:NoneType<span class="op">=</span><span class="va">None</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Same as <code>os.path.relpath</code>, but returns a <code>Path</code>, and resolves symlinks</em></p>
<div id="765fc8ea" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> Path(<span class="st">'../fastcore/'</span>).resolve()</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>Path('/Users/jhoward/aai-ws/fastcore/fastcore')</code></pre>
</div>
</div>
<div id="00f42ab6" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>p.relpath(Path.cwd())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>Path('../fastcore')</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L457" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="path.ls" class="level3">
<h3 class="anchored" data-anchor-id="path.ls">Path.ls</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ls(</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    n_max:NoneType<span class="op">=</span><span class="va">None</span>, file_type:NoneType<span class="op">=</span><span class="va">None</span>, file_exts:NoneType<span class="op">=</span><span class="va">None</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Contents of path as a list</em></p>
<p>We add an <code>ls()</code> method to <code>pathlib.Path</code> which is simply defined as <code>list(Path.iterdir())</code>, mainly for convenience in REPL environments such as notebooks.</p>
<div id="197e61a6" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> Path()</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> path.ls()</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="bu">len</span>(t)<span class="op">&gt;</span><span class="dv">0</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>t1 <span class="op">=</span> path.ls(<span class="dv">10</span>)</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(t1), <span class="dv">10</span>)</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>t2 <span class="op">=</span> path.ls(file_exts<span class="op">=</span><span class="st">'.ipynb'</span>)</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="bu">len</span>(t)<span class="op">&gt;</span><span class="bu">len</span>(t2)</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>t[<span class="dv">0</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>Path('llms.txt')</code></pre>
</div>
</div>
<p>You can also pass an optional <code>file_type</code> MIME prefix and/or a list of file extensions.</p>
<div id="ca8823d0" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>lib_path <span class="op">=</span> (path<span class="op">/</span><span class="st">'../fastcore'</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>txt_files<span class="op">=</span>lib_path.ls(file_type<span class="op">=</span><span class="st">'text'</span>)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="bu">len</span>(txt_files) <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> txt_files[<span class="dv">0</span>].suffix<span class="op">==</span><span class="st">'.py'</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>ipy_files<span class="op">=</span>path.ls(file_exts<span class="op">=</span>[<span class="st">'.ipynb'</span>])</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="bu">len</span>(ipy_files) <span class="op">&gt;</span> <span class="dv">0</span> <span class="kw">and</span> ipy_files[<span class="dv">0</span>].suffix<span class="op">==</span><span class="st">'.ipynb'</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>txt_files[<span class="dv">0</span>],ipy_files[<span class="dv">0</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>(Path('../fastcore/shutil.py'), Path('000_tour.ipynb'))</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L469" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="path.normpath" class="level3">
<h3 class="anchored" data-anchor-id="path.normpath">Path.normpath</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> normpath(</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Normalize path, eliminating double slashes, etc.</em></p>
<p><code>normpath</code> normalizes a path by collapsing redundant separators and up-level references (e.g., <code>..</code>).</p>
<div id="5639a522" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> Path(<span class="st">'foo//bar/../baz'</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>p.normpath()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>Path('foo/baz')</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L475" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="path.__repr__" class="level3">
<h3 class="anchored" data-anchor-id="path.__repr__">Path.__repr__</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">__repr__</span>(</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Return repr(self).</em></p>
<p>fastai also updates the <code>repr</code> of <code>Path</code> such that, if <code>Path.BASE_PATH</code> is defined, all paths are printed relative to that path (as long as they are contained in <code>Path.BASE_PATH</code>:</p>
<div id="bc55f58d" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> ipy_files[<span class="dv">0</span>].absolute()</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    Path.BASE_PATH <span class="op">=</span> t.parent.parent</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">repr</span>(t), <span class="ss">f"Path('nbs/</span><span class="sc">{</span>t<span class="sc">.</span>name<span class="sc">}</span><span class="ss">')"</span>)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="cf">finally</span>: Path.BASE_PATH <span class="op">=</span> <span class="va">None</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L484" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="path.delete" class="level3">
<h3 class="anchored" data-anchor-id="path.delete">Path.delete</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> delete(</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Delete a file, symlink, or directory tree</em></p>
</section>
</section>
<section id="reindexing-collections" class="level2">
<h2 class="anchored" data-anchor-id="reindexing-collections">Reindexing Collections</h2>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L499" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="reindexcollection" class="level4">
<h4 class="anchored" data-anchor-id="reindexcollection">ReindexCollection</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ReindexCollection(</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>    coll, idxs:NoneType<span class="op">=</span><span class="va">None</span>, cache:NoneType<span class="op">=</span><span class="va">None</span>, tfm:function<span class="op">=&lt;</span>function noop at <span class="bn">0x7f717c16cd60</span><span class="op">&gt;</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Reindexes collection <code>coll</code> with indices <code>idxs</code> and optional LRU cache of size <code>cache</code></em></p>
<p>This is useful when constructing batches or organizing data in a particular manner (i.e.&nbsp;for deep learning). This class is primarly used in organizing data for language models in fastai.</p>
<p>You can supply a custom index upon instantiation with the <code>idxs</code> argument, or you can call the <code>reindex</code> method to supply a new index for your collection.</p>
<p>Here is how you can reindex a list such that the elements are reversed:</p>
<div id="8bbb37ef" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>rc<span class="op">=</span>ReindexCollection([<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>, <span class="st">'e'</span>], idxs<span class="op">=</span>[<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">0</span>])</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(rc)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>['e', 'd', 'c', 'b', 'a']</code></pre>
</div>
</div>
<p>Alternatively, you can use the <code>reindex</code> method:</p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L510" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="reindexcollection.reindex" class="level6">
<h6 class="anchored" data-anchor-id="reindexcollection.reindex">ReindexCollection.reindex</h6>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> reindex(</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>    idxs</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Replace <code>self.idxs</code> with idxs</em></p>
<div id="2a07b2f9" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>rc<span class="op">=</span>ReindexCollection([<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>, <span class="st">'e'</span>])</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>rc.reindex([<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">0</span>])</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(rc)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>['e', 'd', 'c', 'b', 'a']</code></pre>
</div>
</div>
<p>You can optionally specify a LRU cache, which uses <a href="https://docs.python.org/3/library/functools.html#functools.lru_cache">functools.lru_cache</a> upon instantiation:</p>
<div id="c8e25bc5" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>sz <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> ReindexCollection(L.<span class="bu">range</span>(sz), cache<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="co">#trigger a cache hit by indexing into the same element multiple times</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>t[<span class="dv">0</span>], t[<span class="dv">0</span>]</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>t._get.cache_info()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>CacheInfo(hits=1, misses=1, maxsize=2, currsize=1)</code></pre>
</div>
</div>
<p>You can optionally clear the LRU cache by calling the <code>cache_clear</code> method:</p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L514" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="reindexcollection.cache_clear" class="level5">
<h5 class="anchored" data-anchor-id="reindexcollection.cache_clear">ReindexCollection.cache_clear</h5>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cache_clear(</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Clear LRU cache</em></p>
<div id="da0f45a7" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>sz <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> ReindexCollection(L.<span class="bu">range</span>(sz), cache<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="co">#trigger a cache hit by indexing into the same element multiple times</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>t[<span class="dv">0</span>], t[<span class="dv">0</span>]</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>t.cache_clear()</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>t._get.cache_info()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>CacheInfo(hits=0, misses=0, maxsize=2, currsize=0)</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L511" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="reindexcollection.shuffle" class="level5">
<h5 class="anchored" data-anchor-id="reindexcollection.shuffle">ReindexCollection.shuffle</h5>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> shuffle(</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Randomly shuffle indices</em></p>
<p>Note that an ordered index is automatically constructed for the data structure even if one is not supplied.</p>
<div id="7cafcd0c" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>rc<span class="op">=</span>ReindexCollection([<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>, <span class="st">'e'</span>, <span class="st">'f'</span>, <span class="st">'g'</span>, <span class="st">'h'</span>])</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>rc.shuffle()</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(rc)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>['b', 'a', 'g', 'h', 'd', 'e', 'c', 'f']</code></pre>
</div>
</div>
<div id="642c0087" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>sz <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> ReindexCollection(L.<span class="bu">range</span>(sz), cache<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(t), <span class="bu">range</span>(sz))</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>test_eq(t[sz<span class="op">-</span><span class="dv">1</span>], sz<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>test_eq(t._get.cache_info().hits, <span class="dv">1</span>)</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>t.shuffle()</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>test_eq(t._get.cache_info().hits, <span class="dv">1</span>)</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>test_ne(<span class="bu">list</span>(t), <span class="bu">range</span>(sz))</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">set</span>(t), <span class="bu">set</span>(<span class="bu">range</span>(sz)))</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>t.cache_clear()</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>test_eq(t._get.cache_info().hits, <span class="dv">0</span>)</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>test_eq(t.count(<span class="dv">0</span>), <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
</section>
<section id="savereturn-and-save_iter-variants" class="level2">
<h2 class="anchored" data-anchor-id="savereturn-and-save_iter-variants"><a href="https://fastcore.fast.ai/xtras.html#savereturn"><code>SaveReturn</code></a> and <a href="https://fastcore.fast.ai/xtras.html#save_iter"><code>save_iter</code></a> Variants</h2>
<p>These utilities solve a common problem in Python: how to extract additional information from generator functions beyond just the yielded values.</p>
<p>In Python, generator functions can <code>yield</code> values and also <code>return</code> a final value, but the return value is normally lost when you iterate over the generator:</p>
<div id="566d7941" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> example_generator():</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>        total <span class="op">+=</span> i</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> i</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> total  <span class="co"># This gets lost!</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="co"># The return value (3) is lost</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> <span class="bu">list</span>(example_generator())  <span class="co"># [0, 1, 2]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L523" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="savereturn" class="level3">
<h3 class="anchored" data-anchor-id="savereturn">SaveReturn</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> SaveReturn(</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>    its</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Wrap an iterator such that the generator function’s return value is stored in <code>.value</code></em></p>
<div id="59a2f54d" class="cell">
<details open="" class="code-fold">
<summary>Exported source</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SaveReturn:</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"Wrap an iterator such that the generator function's return value is stored in `.value`"</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, its): <span class="va">self</span>.its <span class="op">=</span> its</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__iter__</span>(<span class="va">self</span>):</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.value <span class="op">=</span> <span class="cf">yield</span> <span class="cf">from</span> <span class="va">self</span>.its</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.value</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p><a href="https://fastcore.fast.ai/xtras.html#savereturn"><code>SaveReturn</code></a> is the simplest approach to solving this problem - it wraps any existing (non-async) generator and captures its return value. This works because <code>yield from</code> (used internally in <a href="https://fastcore.fast.ai/xtras.html#savereturn"><code>SaveReturn</code></a>) returns the value from the <code>return</code> of the generator function.</p>
<div id="cbb65e6f" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sum_range(n):</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>        total <span class="op">+=</span> i</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> i</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> total  <span class="co"># This value is returned by yield from</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>sr <span class="op">=</span> SaveReturn(sum_range(<span class="dv">5</span>))</span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> <span class="bu">list</span>(sr)  <span class="co"># This will consume the generator and get the return value</span></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Values: </span><span class="sc">{</span>values<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>sr.value</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Values: [0, 1, 2, 3, 4]</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>10</code></pre>
</div>
</div>
<p>In order to provide an accurate signature for <a href="https://fastcore.fast.ai/xtras.html#save_iter"><code>save_iter</code></a>, we need a version of <code>wraps</code> that removes leading parameters:</p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L531" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="trim_wraps" class="level3">
<h3 class="anchored" data-anchor-id="trim_wraps">trim_wraps</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> trim_wraps(</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>    f, n:<span class="bu">int</span><span class="op">=</span><span class="dv">1</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Like wraps, but removes the first n parameters from the signature</em></p>
<p><a href="https://fastcore.fast.ai/xtras.html#trim_wraps"><code>trim_wraps</code></a> is a decorator factory that works like <code>functools.wraps</code>, but removes the first <code>n</code> parameters from the wrapped function’s signature. This is useful when creating wrapper functions that consume some parameters internally and shouldn’t expose them in the public API.</p>
<div id="b4d2e6d1" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> adder(base, x, y): <span class="cf">return</span> base <span class="op">+</span> x <span class="op">+</span> y</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_adder(base_value):</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">@trim_wraps</span>(adder)</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> _(x, y): <span class="cf">return</span> adder(base_value, x, y)</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> _</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>add_10 <span class="op">=</span> make_adder(<span class="dv">10</span>)</span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>add_10<span class="sc">.</span><span class="va">__name__</span><span class="sc">}{</span>inspect<span class="sc">.</span>signature(add_10)<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>adder(x, y)</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L548" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="save_iter" class="level3">
<h3 class="anchored" data-anchor-id="save_iter">save_iter</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_iter(</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>    g</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Decorator that allows a generator function to store values in the returned iterator object</em></p>
<p><a href="https://fastcore.fast.ai/xtras.html#save_iter"><code>save_iter</code></a> modifies generator functions to store state in the iterator object itself. The generator receives an object as its first parameter, which it can use to store attributes. You can store values during iteration, not just at the end, and you can store multiple attributes if needed.</p>
<div id="55b01b36" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="at">@save_iter</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sum_range(o, n):  <span class="co"># Note: 'o' parameter added</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>        total <span class="op">+=</span> i</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> i</span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>    o.value <span class="op">=</span> total  <span class="co"># Store directly on the iterator object</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Because iternally <a href="https://fastcore.fast.ai/xtras.html#save_iter"><code>save_iter</code></a> uses <a href="https://fastcore.fast.ai/xtras.html#trim_wraps"><code>trim_wraps</code></a>, the signature of <code>sum_range</code> correctly shows that you should <em>not</em> pass <code>o</code> to it; it’s injected by the decorating function.</p>
<div id="b3c5fb3d" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sum_range.__signature__)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(n)</code></pre>
</div>
</div>
<div id="65335317" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>sr <span class="op">=</span> sum_range(<span class="dv">5</span>)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Values: </span><span class="sc">{</span><span class="bu">list</span>(sr)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Sum stored: </span><span class="sc">{</span>sr<span class="sc">.</span>value<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Values: [0, 1, 2, 3, 4]
Sum stored: 10</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L555" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="asave_iter" class="level3">
<h3 class="anchored" data-anchor-id="asave_iter">asave_iter</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> asave_iter(</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>    g</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Like <a href="https://fastcore.fast.ai/xtras.html#save_iter"><code>save_iter</code></a>, but for async iterators</em></p>
<p><a href="https://fastcore.fast.ai/xtras.html#asave_iter"><code>asave_iter</code></a> provides the same functionality as <a href="https://fastcore.fast.ai/xtras.html#save_iter"><code>save_iter</code></a>, but for async generator functions. <code>yield from</code> and <code>return</code> can not be used with async generator functions, so <a href="https://fastcore.fast.ai/xtras.html#savereturn"><code>SaveReturn</code></a> can’t be used here.</p>
<div id="41de7df9" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb128"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="at">@asave_iter</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> asum_range(<span class="va">self</span>, n):</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(n):</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>        total <span class="op">+=</span> i</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> i</span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">self</span>.value <span class="op">=</span> total</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>asr <span class="op">=</span> asum_range(<span class="dv">5</span>)</span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Values: </span><span class="sc">{</span>[o <span class="cf">async</span> <span class="cf">for</span> o <span class="kw">in</span> asr]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Sum stored: </span><span class="sc">{</span>asr<span class="sc">.</span>value<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Values: [0, 1, 2, 3, 4]
Sum stored: 10</code></pre>
</div>
</div>
</section>
</section>
<section id="other-helpers" class="level2">
<h2 class="anchored" data-anchor-id="other-helpers">Other Helpers</h2>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L562" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="unqid" class="level3">
<h3 class="anchored" data-anchor-id="unqid">unqid</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> unqid(</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>    seeded:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Generate a unique id suitable for use as a Python identifier</em></p>
<p><a href="https://fastcore.fast.ai/xtras.html#unqid"><code>unqid</code></a> generates a random unique identifier that is safe to use as a Python variable name (starts with <code>_</code>, uses only alphanumeric characters and underscores). It’s based on UUID4, encoded in URL-safe base64.</p>
<p>If <code>seeded=True</code>, uses <code>random.getrandbits</code> which respects <code>random.seed()</code>, making it reproducible. Otherwise uses <code>uuid4()</code> which is always random.</p>
<div id="8e065069" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>unqid()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>'_7WDcaL3JT7qV037u3Werzw'</code></pre>
</div>
</div>
<p>With seeding for reproducibility:</p>
<div id="b37f4eed" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">42</span>)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> unqid(seeded<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">42</span>)</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> unqid(seeded<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>test_eq(a, b)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Without seeding - always unique:</p>
<div id="355ab870" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>test_ne(unqid(), unqid())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L571" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="rtoken_hex" class="level3">
<h3 class="anchored" data-anchor-id="rtoken_hex">rtoken_hex</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb135"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rtoken_hex(</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>    nbytes:<span class="bu">int</span><span class="op">=</span><span class="dv">16</span>, <span class="co"># Number of bytes to generate</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>)<span class="op">-&gt;</span><span class="bu">str</span>: <span class="co"># hex string of length nbytes*2</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Generate a random hex string using Python’s random module.</em></p>
<p>This is the same as <code>secrets.token_hex</code>, but is reproducible/seedable.</p>
<div id="cad38878" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb136"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> secrets</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="b5de612a" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb137"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>secrets.token_hex(<span class="dv">4</span>),rtoken_hex(<span class="dv">4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>('408ea190', '8c7d7247')</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L579" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="friendly_name" class="level3">
<h3 class="anchored" data-anchor-id="friendly_name">friendly_name</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb139"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> friendly_name(</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>    levels:<span class="bu">int</span><span class="op">=</span><span class="dv">3</span>, suffix:<span class="bu">int</span><span class="op">=</span><span class="dv">4</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Generate a random human-readable name with customizable word levels and suffix length</em></p>
<p><a href="https://fastcore.fast.ai/xtras.html#friendly_name"><code>friendly_name</code></a> generates random, human-readable names by combining adjectives, nouns, verbs, and adverbs with a random alphanumeric suffix. This is useful for creating memorable identifiers for temporary files, test data, or user-friendly resource names.</p>
<div id="dc83b044" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb140"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>friendly_name()  <span class="co"># Default: 3 word levels + 4-char suffix</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>'objective-forest-builds-0y6d'</code></pre>
</div>
</div>
<p>Names are hyphen-separated and follow the pattern <code>adjective-noun-verb-adverb</code>, randomly chosen from lists of size 102, 116, 110, and 30, respectively. The <code>levels</code> param selects how many of the names to include:</p>
<div id="7a518ed2" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb142"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>friendly_name(<span class="dv">2</span>)  <span class="co"># 2 words + 4-char suffix</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>'lavender-hummingbird-divu'</code></pre>
</div>
</div>
<p><code>suffix</code> sets the length of the random alphanumeric ending. Each suffix item is taken from the 36 options of lowercase letters plus digits.</p>
<div id="00cea859" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>friendly_name(<span class="dv">4</span>, <span class="dv">6</span>)  <span class="co"># All 4 word types + 6-char suffix</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>'elated-koala-begins-softly-zpqk51'</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L591" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="n_friendly_names" class="level3">
<h3 class="anchored" data-anchor-id="n_friendly_names">n_friendly_names</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> n_friendly_names(</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>    levels:<span class="bu">int</span><span class="op">=</span><span class="dv">3</span>, suffix:<span class="bu">int</span><span class="op">=</span><span class="dv">4</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Number of possible combos for `friendly_names</em></p>
<p>The number of combinations if all levels are included is:</p>
<div id="ae2234cc" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>n_friendly_names(<span class="dv">4</span>)<span class="sc">:,}</span><span class="ss">'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>65,581,614,489,600</code></pre>
</div>
</div>
<p>The default settings give:</p>
<div id="6419cd57" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>n_friendly_names()<span class="sc">:,}</span><span class="ss">'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>2,186,053,816,320</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L597" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="exec_eval" class="level3">
<h3 class="anchored" data-anchor-id="exec_eval">exec_eval</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> exec_eval(</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>    code, <span class="co"># Code to exec/eval</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>    g:NoneType<span class="op">=</span><span class="va">None</span>, <span class="co"># Globals namespace dict</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>    l:NoneType<span class="op">=</span><span class="va">None</span>, <span class="co"># Locals namespace dict</span></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Evaluate <code>code</code> in <code>g</code> (defaults to <code>globals()</code>) and <code>l</code> (defaults to <code>locals()</code>)</em></p>
<p>This is a combination of <code>eval</code> and <code>exec</code>, which behaves like ipython and Jupyter. If the last line is an expression, it is evaluated and the result is returned:</p>
<div id="155b5188" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb152"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>exec_eval(<span class="st">'''</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="st">def f(x): return x+1</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a><span class="st">f(1)</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a><span class="st">'''</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>2</code></pre>
</div>
</div>
<p>By default, the code uses the caller’s globals and locals. For instance, here <code>f</code> is available since it’s been added to our symbol table:</p>
<div id="5a7f35b1" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>exec_eval(<span class="st">'print(f(2))'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>3</code></pre>
</div>
</div>
<p>Pass a dict as the <code>g</code> param in order to use an arbitrary namespace:</p>
<div id="ea8d90cb" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>exec_eval(<span class="st">'print(f)'</span>, {<span class="st">'f'</span>: <span class="st">'Hi I am f.'</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Hi I am f.</code></pre>
</div>
</div>
<p>This function helps us identify the first declared raw function of a dispatched function:</p>
<div id="f6f873e2" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plum <span class="im">import</span> Function</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="6443f18b" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f1(x): <span class="cf">return</span> <span class="st">"Any"</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f2(x:<span class="bu">int</span>): <span class="cf">return</span> <span class="st">"Int"</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> Function(f1).dispatch(f1).dispatch(f2)</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>test_eq(_unwrapped_type_dispatch_func(df), f1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L631" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_source_link" class="level3">
<h3 class="anchored" data-anchor-id="get_source_link">get_source_link</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb160"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_source_link(</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>    func</span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Return link to <code>func</code> in source code</em></p>
<p><a href="https://fastcore.fast.ai/xtras.html#get_source_link"><code>get_source_link</code></a> allows you get a link to source code related to an object. For <a href="https://github.com/fastai/nbdev">nbdev</a> related projects such as fastcore, we can get the full link to a GitHub repo. For <code>nbdev</code> projects, be sure to properly set the <code>git_url</code> in <code>settings.ini</code> (derived from <code>lib_name</code> and <code>branch</code> on top of the prefix you will need to adapt) so that those links are correct.</p>
<p>For example, below we get the link to <a href="https://fastcore.fast.ai/test.html#test_eq"><code>fastcore.test.test_eq</code></a>:</p>
<div id="7cdda557" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb161"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastcore.test <span class="im">import</span> test_eq</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cf6b05e3" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb162"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="st">'fastcore/test.py'</span> <span class="kw">in</span> get_source_link(test_eq)</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> get_source_link(test_eq).startswith(<span class="st">'https://github.com/AnswerDotAI/fastcore'</span>)</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>get_source_link(test_eq)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>'https://github.com/AnswerDotAI/fastcore/fastcore/test.py#L38'</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L658" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="sparkline" class="level3">
<h3 class="anchored" data-anchor-id="sparkline">sparkline</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb164"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sparkline(</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>    data, mn:NoneType<span class="op">=</span><span class="va">None</span>, mx:NoneType<span class="op">=</span><span class="va">None</span>, empty_zero:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span></span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Sparkline for <code>data</code>, with <code>None</code>s (and zero, if <code>empty_zero</code>) shown as empty column</em></p>
<div id="db3588fa" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb165"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> [<span class="dv">9</span>,<span class="dv">6</span>,<span class="va">None</span>,<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">0</span>,<span class="dv">8</span>,<span class="dv">15</span>,<span class="dv">10</span>]</span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'without "empty_zero": </span><span class="sc">{</span>sparkline(data, empty_zero<span class="op">=</span><span class="va">False</span>)<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'   with "empty_zero": </span><span class="sc">{</span>sparkline(data, empty_zero<span class="op">=</span><span class="va">True</span> )<span class="sc">}</span><span class="ss">'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>without "empty_zero": ▅▂ ▁▂▁▃▇▅
   with "empty_zero": ▅▂ ▁▂ ▃▇▅</code></pre>
</div>
</div>
<p>You can set a maximum and minimum for the y-axis of the sparkline with the arguments <code>mn</code> and <code>mx</code> respectively:</p>
<div id="cc1f2daf" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb167"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>sparkline([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">400</span>], mn<span class="op">=</span><span class="dv">0</span>, mx<span class="op">=</span><span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>'▂▅▇▇'</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L667" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="modify_exception" class="level3">
<h3 class="anchored" data-anchor-id="modify_exception">modify_exception</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb169"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> modify_exception(</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>    e:<span class="pp">Exception</span>, <span class="co"># An exception</span></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>    msg:<span class="bu">str</span><span class="op">=</span><span class="va">None</span>, <span class="co"># A custom message</span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>    replace:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span>, <span class="co"># Whether to replace e.args with [msg]</span></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>)<span class="op">-&gt;</span><span class="pp">Exception</span>:</span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Modifies <code>e</code> with a custom message attached</em></p>
<div id="0356819b" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb170"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>msg <span class="op">=</span> <span class="st">"This is my custom message!"</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>test_fail(<span class="kw">lambda</span>: (_ <span class="cf">for</span> _ <span class="kw">in</span> ()).throw(modify_exception(<span class="pp">Exception</span>(), <span class="va">None</span>)), contains<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>test_fail(<span class="kw">lambda</span>: (_ <span class="cf">for</span> _ <span class="kw">in</span> ()).throw(modify_exception(<span class="pp">Exception</span>(), msg)), contains<span class="op">=</span>msg)</span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>test_fail(<span class="kw">lambda</span>: (_ <span class="cf">for</span> _ <span class="kw">in</span> ()).throw(modify_exception(<span class="pp">Exception</span>(<span class="st">"The first message"</span>), msg)), contains<span class="op">=</span><span class="st">"The first message This is my custom message!"</span>)</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>test_fail(<span class="kw">lambda</span>: (_ <span class="cf">for</span> _ <span class="kw">in</span> ()).throw(modify_exception(<span class="pp">Exception</span>(<span class="st">"The first message"</span>), msg, <span class="va">True</span>)), contains<span class="op">=</span><span class="st">"This is my custom message!"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L677" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="round_multiple" class="level3">
<h3 class="anchored" data-anchor-id="round_multiple">round_multiple</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb171"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> round_multiple(</span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>    x, mult, round_down:<span class="bu">bool</span><span class="op">=</span><span class="va">False</span></span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Round <code>x</code> to nearest multiple of <code>mult</code></em></p>
<div id="5f2a4659" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb172"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>test_eq(round_multiple(<span class="dv">63</span>,<span class="dv">32</span>), <span class="dv">64</span>)</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>test_eq(round_multiple(<span class="dv">50</span>,<span class="dv">32</span>), <span class="dv">64</span>)</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>test_eq(round_multiple(<span class="dv">40</span>,<span class="dv">32</span>), <span class="dv">32</span>)</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>test_eq(round_multiple( <span class="dv">0</span>,<span class="dv">32</span>),  <span class="dv">0</span>)</span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>test_eq(round_multiple(<span class="dv">63</span>,<span class="dv">32</span>, round_down<span class="op">=</span><span class="va">True</span>), <span class="dv">32</span>)</span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>test_eq(round_multiple((<span class="dv">63</span>,<span class="dv">40</span>),<span class="dv">32</span>), (<span class="dv">64</span>,<span class="dv">32</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L684" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="set_num_threads" class="level3">
<h3 class="anchored" data-anchor-id="set_num_threads">set_num_threads</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb173"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> set_num_threads(</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>    nt</span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Get numpy (and others) to use <code>nt</code> threads</em></p>
<p>This sets the number of threads consistently for many tools, by:</p>
<ol type="1">
<li>Set the following environment variables equal to <code>nt</code>: <code>OPENBLAS_NUM_THREADS</code>,<code>NUMEXPR_NUM_THREADS</code>,<code>OMP_NUM_THREADS</code>,<code>MKL_NUM_THREADS</code></li>
<li>Sets <code>nt</code> threads for numpy and pytorch.</li>
</ol>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L695" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="join_path_file" class="level3">
<h3 class="anchored" data-anchor-id="join_path_file">join_path_file</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb174"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> join_path_file(</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">file</span>, path, ext:<span class="bu">str</span><span class="op">=</span><span class="st">''</span></span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Return <code>path/file</code> if file is a string or a <code>Path</code>, file otherwise</em></p>
<div id="a0f6eaa4" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb175"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> Path.cwd()<span class="op">/</span><span class="st">'_tmp'</span><span class="op">/</span><span class="st">'tst'</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> join_path_file(<span class="st">'tst.txt'</span>, path)</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> path.exists()</span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>test_eq(f, path<span class="op">/</span><span class="st">'tst.txt'</span>)</span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(f, <span class="st">'w'</span>) <span class="im">as</span> f_: <span class="cf">assert</span> join_path_file(f_, path) <span class="op">==</span> f_</span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>shutil.rmtree(Path.cwd()<span class="op">/</span><span class="st">'_tmp'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L702" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="autostart" class="level3">
<h3 class="anchored" data-anchor-id="autostart">autostart</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb176"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> autostart(</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>    g</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Decorator that automatically starts a generator</em></p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L712" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="eventtimer" class="level4">
<h4 class="anchored" data-anchor-id="eventtimer">EventTimer</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb177"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> EventTimer(</span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>    store:<span class="bu">int</span><span class="op">=</span><span class="dv">5</span>, span:<span class="bu">int</span><span class="op">=</span><span class="dv">60</span></span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>An event timer with history of <code>store</code> items of time <code>span</code></em></p>
<p>Add events with <code>add</code>, and get number of <code>events</code> and their frequency (<code>freq</code>).</p>
<div id="d5d39cff" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb178"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Random wait function for testing</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _randwait(): <span class="cf">yield</span> <span class="cf">from</span> (sleep(random.random()<span class="op">/</span><span class="dv">200</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">100</span>))</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> EventTimer(store<span class="op">=</span><span class="dv">5</span>, span<span class="op">=</span><span class="fl">0.03</span>)</span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> o <span class="kw">in</span> _randwait(): c.add(<span class="dv">1</span>)</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Num Events: </span><span class="sc">{</span>c<span class="sc">.</span>events<span class="sc">}</span><span class="ss">, Freq/sec: </span><span class="sc">{</span>c<span class="sc">.</span>freq<span class="sc">:.01f}</span><span class="ss">'</span>)</span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Most recent: '</span>, sparkline(c.hist), <span class="op">*</span>L(c.hist).<span class="bu">map</span>(<span class="st">'</span><span class="sc">{:.01f}</span><span class="st">'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Num Events: 1, Freq/sec: 73.6
Most recent:  ▁▁▂▅▇ 33.0 26.9 54.1 89.8 120.6</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L739" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="stringfmt_names" class="level3">
<h3 class="anchored" data-anchor-id="stringfmt_names">stringfmt_names</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb180"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> stringfmt_names(</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>    s:<span class="bu">str</span></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>)<span class="op">-&gt;</span><span class="bu">list</span>:</span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Unique brace-delimited names in <code>s</code></em></p>
<div id="10efda65" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb181"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> <span class="st">'/pulls/</span><span class="sc">{pull_number}</span><span class="st">/reviews/</span><span class="sc">{review_id}</span><span class="st">'</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>test_eq(stringfmt_names(s), [<span class="st">'pull_number'</span>,<span class="st">'review_id'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L744" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="partialformatter" class="level4">
<h4 class="anchored" data-anchor-id="partialformatter">PartialFormatter</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb182"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> PartialFormatter(</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>A <code>string.Formatter</code> that doesn’t error on missing fields, and tracks missing fields and unused args</em></p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L760" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="partial_format" class="level3">
<h3 class="anchored" data-anchor-id="partial_format">partial_format</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb183"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> partial_format(</span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>    s:<span class="bu">str</span>, kwargs:VAR_KEYWORD</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>string format <code>s</code>, ignoring missing field errors, returning missing and extra fields</em></p>
<p>The result is a tuple of <code>(formatted_string,missing_fields,extra_fields)</code>, e.g:</p>
<div id="c990509b" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb184"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>res,missing,xtra <span class="op">=</span> partial_format(s, pull_number<span class="op">=</span><span class="dv">1</span>, foo<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>test_eq(res, <span class="st">'/pulls/1/reviews/</span><span class="sc">{review_id}</span><span class="st">'</span>)</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>test_eq(missing, [<span class="st">'review_id'</span>])</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>test_eq(xtra, {<span class="st">'foo'</span>:<span class="dv">2</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L767" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="truncstr" class="level3">
<h3 class="anchored" data-anchor-id="truncstr">truncstr</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb185"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> truncstr(</span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>    s:<span class="bu">str</span>, maxlen:<span class="bu">int</span>, suf:<span class="bu">str</span><span class="op">=</span><span class="st">'…'</span>, space:<span class="bu">str</span><span class="op">=</span><span class="st">''</span>, sizevar:<span class="bu">str</span><span class="op">=</span><span class="va">None</span></span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a>)<span class="op">-&gt;</span><span class="bu">str</span>:</span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Truncate <code>s</code> to length <code>maxlen</code>, adding suffix <code>suf</code> if truncated</em></p>
<div id="52f5b1d4" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb186"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> <span class="st">'abacadabra'</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>test_eq(truncstr(w, <span class="dv">10</span>), w)</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>test_eq(truncstr(w, <span class="dv">5</span>), <span class="st">'abac…'</span>)</span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>test_eq(truncstr(w, <span class="dv">5</span>, suf<span class="op">=</span><span class="st">''</span>), <span class="st">'abaca'</span>)</span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>test_eq(truncstr(w, <span class="dv">11</span>, space<span class="op">=</span><span class="st">'_'</span>), w<span class="op">+</span><span class="st">"_"</span>)</span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a>test_eq(truncstr(w, <span class="dv">10</span>, space<span class="op">=</span><span class="st">'_'</span>), w[:<span class="op">-</span><span class="dv">1</span>]<span class="op">+</span><span class="st">'…'</span>)</span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a>test_eq(truncstr(w, <span class="dv">5</span>, suf<span class="op">=</span><span class="st">'!!'</span>), <span class="st">'aba!!'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>sizevar</code> lets you include the original string length in your suffix. E.g when you set <code>sizevar='_n_'</code>, any <code>{_n_}</code> in your suffix gets replaced with the actual length of the string before truncation. For instance, here the <code>(11)</code> tells you the original string was 11 characters long:</p>
<div id="0c0d2db7" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb187"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>test_eq(truncstr(<span class="st">'hello world'</span>, <span class="dv">8</span>, suf<span class="op">=</span><span class="st">'…(</span><span class="sc">{_n_}</span><span class="st">)'</span>, sizevar<span class="op">=</span><span class="st">'_n_'</span>), <span class="st">'hel…(11)'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L773" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="utc2local" class="level3">
<h3 class="anchored" data-anchor-id="utc2local">utc2local</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb188"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> utc2local(</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>    dt:datetime</span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>)<span class="op">-&gt;</span>datetime:</span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Convert <code>dt</code> from UTC to local time</em></p>
<div id="d1278d6c" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb189"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>dt <span class="op">=</span> datetime(<span class="dv">2000</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">12</span>)</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>dt<span class="sc">}</span><span class="ss"> UTC is </span><span class="sc">{</span>utc2local(dt)<span class="sc">}</span><span class="ss"> local time'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>2000-01-01 12:00:00 UTC is 2000-01-01 22:00:00+10:00 local time</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L778" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="local2utc" class="level3">
<h3 class="anchored" data-anchor-id="local2utc">local2utc</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb191"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> local2utc(</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>    dt:datetime</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>)<span class="op">-&gt;</span>datetime:</span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Convert <code>dt</code> from local to UTC time</em></p>
<div id="8756e202" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb192"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'</span><span class="sc">{</span>dt<span class="sc">}</span><span class="ss"> local is </span><span class="sc">{</span>local2utc(dt)<span class="sc">}</span><span class="ss"> UTC time'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>2000-01-01 12:00:00 local is 2000-01-01 02:00:00+00:00 UTC time</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L783" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="trace" class="level3">
<h3 class="anchored" data-anchor-id="trace">trace</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb194"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> trace(</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>    f</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Add <code>set_trace</code> to an existing function <code>f</code></em></p>
<p>You can add a breakpoint to an existing function, e.g:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb195"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>Path.cwd <span class="op">=</span> trace(Path.cwd)</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>Path.cwd()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now, when the function is called it will drop you into the debugger. Note, you must issue the <code>s</code> command when you begin to step into the function that is being traced.</p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L795" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="modified_env" class="level3">
<h3 class="anchored" data-anchor-id="modified_env">modified_env</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb196"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> modified_env(</span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>    delete:VAR_POSITIONAL, replace:VAR_KEYWORD</span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Context manager temporarily modifying <code>os.environ</code> by deleting <code>delete</code> and replacing <code>replace</code></em></p>
<div id="3d0d0d9a" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb197"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="co"># USER isn't in Cloud Linux Environments</span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>env_test <span class="op">=</span> <span class="st">'USERNAME'</span> <span class="cf">if</span> sys.platform <span class="op">==</span> <span class="st">"win32"</span> <span class="cf">else</span> <span class="st">'SHELL'</span></span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>oldusr <span class="op">=</span> os.environ[env_test]</span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>replace_param <span class="op">=</span> {env_test: <span class="st">'a'</span>}</span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> modified_env(<span class="st">'PATH'</span>, <span class="op">**</span>replace_param):</span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a>    test_eq(os.environ[env_test], <span class="st">'a'</span>)</span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="st">'PATH'</span> <span class="kw">not</span> <span class="kw">in</span> os.environ</span>
<span id="cb197-9"><a href="#cb197-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-10"><a href="#cb197-10" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="st">'PATH'</span> <span class="kw">in</span> os.environ</span>
<span id="cb197-11"><a href="#cb197-11" aria-hidden="true" tabindex="-1"></a>test_eq(os.environ[env_test], oldusr)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L807" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="contextmanagers" class="level4">
<h4 class="anchored" data-anchor-id="contextmanagers">ContextManagers</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb198"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ContextManagers(</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>    mgrs</span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Wrapper for <code>contextlib.ExitStack</code> which enters a collection of context managers</em></p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L814" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
</section>
<section id="shufflish" class="level3">
<h3 class="anchored" data-anchor-id="shufflish">shufflish</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb199"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> shufflish(</span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>    x, pct:<span class="bu">float</span><span class="op">=</span><span class="fl">0.04</span></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Randomly relocate items of <code>x</code> up to <code>pct</code> of <code>len(x)</code> from their starting location</em></p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L821" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="console_help" class="level3">
<h3 class="anchored" data-anchor-id="console_help">console_help</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb200"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> console_help(</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>    libname:<span class="bu">str</span>, <span class="co"># name of library for console script listing</span></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Show help for all console scripts from <code>libname</code></em></p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L833" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="hl_md" class="level3">
<h3 class="anchored" data-anchor-id="hl_md">hl_md</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb201"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> hl_md(</span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>    s, lang:<span class="bu">str</span><span class="op">=</span><span class="st">'html'</span>, show:<span class="bu">bool</span><span class="op">=</span><span class="va">True</span></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Syntax highlight <code>s</code> using <code>lang</code>.</em></p>
<p>When we display code in a notebook, it’s nice to highlight it, so we create a function to simplify that:</p>
<div id="abf99c3f" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb202"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>hl_md(<span class="st">'&lt;test&gt;&lt;xml foo="bar"&gt;a child&lt;/xml&gt;&lt;/test&gt;'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display cell-output-markdown">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb203"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">test</span><span class="dt">&gt;&lt;</span><span class="kw">xml</span><span class="ot"> foo</span><span class="op">=</span><span class="st">"bar"</span><span class="dt">&gt;</span>a child<span class="dt">&lt;/</span><span class="kw">xml</span><span class="dt">&gt;&lt;/</span><span class="kw">test</span><span class="dt">&gt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L844" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="type2str" class="level3">
<h3 class="anchored" data-anchor-id="type2str">type2str</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb204"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> type2str(</span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>    typ:<span class="bu">type</span></span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>)<span class="op">-&gt;</span><span class="bu">str</span>:</span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Stringify <code>typ</code></em></p>
<div id="b8b7b6c4" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb205"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>test_eq(type2str(Optional[<span class="bu">float</span>]), <span class="st">'Union[float, None]'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L855" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="dataclass_src" class="level3">
<h3 class="anchored" data-anchor-id="dataclass_src">dataclass_src</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb206"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dataclass_src(</span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>    cls</span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="58908987" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb207"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>DC <span class="op">=</span> make_dataclass(<span class="st">'DC'</span>, [(<span class="st">'x'</span>, <span class="bu">int</span>), (<span class="st">'y'</span>, Optional[<span class="bu">float</span>], <span class="va">None</span>), (<span class="st">'z'</span>, <span class="bu">float</span>, <span class="va">None</span>)])</span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dataclass_src(DC))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>@dataclass
class DC:
    x: int
    y: Union[float, None] = None
    z: float = None
</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L863" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="unset" class="level3">
<h3 class="anchored" data-anchor-id="unset">Unset</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb209"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Unset(</span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a>    args:VAR_POSITIONAL, kwds:VAR_KEYWORD</span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Create a collection of name/value pairs.</em></p>
<p>Example enumeration:</p>
<blockquote class="blockquote">
<blockquote class="blockquote">
<blockquote class="blockquote">
<p>class Color(Enum): … RED = 1 … BLUE = 2 … GREEN = 3</p>
</blockquote>
</blockquote>
</blockquote>
<p>Access them by:</p>
<ul>
<li><p>attribute access:</p>
<blockquote class="blockquote">
<blockquote class="blockquote">
<blockquote class="blockquote">
<p>Color.RED &lt;Color.RED: 1&gt;</p>
</blockquote>
</blockquote>
</blockquote></li>
<li><p>value lookup:</p>
<blockquote class="blockquote">
<blockquote class="blockquote">
<blockquote class="blockquote">
<p>Color(1) &lt;Color.RED: 1&gt;</p>
</blockquote>
</blockquote>
</blockquote></li>
<li><p>name lookup:</p>
<blockquote class="blockquote">
<blockquote class="blockquote">
<blockquote class="blockquote">
<p>Color[‘RED’] &lt;Color.RED: 1&gt;</p>
</blockquote>
</blockquote>
</blockquote></li>
</ul>
<p>Enumerations can be iterated over, and know how many members they have:</p>
<blockquote class="blockquote">
<blockquote class="blockquote">
<blockquote class="blockquote">
<p>len(Color) 3</p>
</blockquote>
</blockquote>
</blockquote>
<blockquote class="blockquote">
<blockquote class="blockquote">
<blockquote class="blockquote">
<p>list(Color) [&lt;Color.RED: 1&gt;, &lt;Color.BLUE: 2&gt;, &lt;Color.GREEN: 3&gt;]</p>
</blockquote>
</blockquote>
</blockquote>
<p>Methods can be added to enumerations, and members can have their own attributes – see the documentation for details.</p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L871" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="nullable_dc" class="level3">
<h3 class="anchored" data-anchor-id="nullable_dc">nullable_dc</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb210"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> nullable_dc(</span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>    cls</span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Like <code>dataclass</code>, but default of <code>UNSET</code> added to fields without defaults</em></p>
<div id="c7d70e0c" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb211"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="at">@nullable_dc</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Person: name: <span class="bu">str</span><span class="op">;</span> age: <span class="bu">int</span><span class="op">;</span> city: <span class="bu">str</span> <span class="op">=</span> <span class="st">"Unknown"</span></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>Person(name<span class="op">=</span><span class="st">"Bob"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>Person(name='Bob', age=UNSET, city='Unknown')</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L878" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="make_nullable" class="level3">
<h3 class="anchored" data-anchor-id="make_nullable">make_nullable</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb213"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_nullable(</span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a>    clas</span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="72b22fa8" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb214"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="at">@dataclass</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Person: name: <span class="bu">str</span><span class="op">;</span> age: <span class="bu">int</span><span class="op">;</span> city: <span class="bu">str</span> <span class="op">=</span> <span class="st">"Unknown"</span></span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>make_nullable(Person)</span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a>Person(<span class="st">"Bob"</span>, city<span class="op">=</span><span class="st">'NY'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>Person(name='Bob', age=UNSET, city='NY')</code></pre>
</div>
</div>
<div id="19516b10" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb216"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>Person(name<span class="op">=</span><span class="st">"Bob"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>Person(name='Bob', age=UNSET, city='Unknown')</code></pre>
</div>
</div>
<div id="bef2318a" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb218"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>Person(<span class="st">"Bob"</span>, <span class="dv">34</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>Person(name='Bob', age=34, city='Unknown')</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L900" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="flexiclass" class="level3">
<h3 class="anchored" data-anchor-id="flexiclass">flexiclass</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb220"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> flexiclass(</span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a>    cls, <span class="co"># The class to convert</span></span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a>)<span class="op">-&gt;</span>dataclass:</span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Convert <code>cls</code> into a <code>dataclass</code> like <a href="https://fastcore.fast.ai/xtras.html#make_nullable"><code>make_nullable</code></a>. Converts in place and also returns the result.</em></p>
<p>This can be used as a decorator…</p>
<div id="9fd419f3" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb221"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="at">@flexiclass</span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Person: name: <span class="bu">str</span><span class="op">;</span> age: <span class="bu">int</span><span class="op">;</span> city: <span class="bu">str</span> <span class="op">=</span> <span class="st">"Unknown"</span></span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a>bob <span class="op">=</span> Person(name<span class="op">=</span><span class="st">"Bob"</span>)</span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a>bob</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>Person(name='Bob', age=UNSET, city='Unknown')</code></pre>
</div>
</div>
<p>…or can update the behavior of an existing class (or dataclass):</p>
<div id="5f74eaf5" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb223"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Person: name: <span class="bu">str</span><span class="op">;</span> age: <span class="bu">int</span><span class="op">;</span> city: <span class="bu">str</span> <span class="op">=</span> <span class="st">"Unknown"</span></span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>flexiclass(Person)</span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a>bob <span class="op">=</span> Person(name<span class="op">=</span><span class="st">"Bob"</span>)</span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a>bob</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>Person(name='Bob', age=UNSET, city='Unknown')</code></pre>
</div>
</div>
<p>Action occurs in-place:</p>
<div id="0a22024f" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb225"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Person: name: <span class="bu">str</span><span class="op">;</span> age: <span class="bu">int</span><span class="op">;</span> city: <span class="bu">str</span> <span class="op">=</span> <span class="st">"Unknown"</span></span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a>flexiclass(Person)</span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a>is_dataclass(Person)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>True</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L911" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="asdict" class="level3">
<h3 class="anchored" data-anchor-id="asdict">asdict</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb227"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> asdict(</span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a>    o</span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a>)<span class="op">-&gt;</span><span class="bu">dict</span>:</span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Convert <code>o</code> to a <code>dict</code>, supporting dataclasses, namedtuples, iterables, and <code>__dict__</code> attrs.</em></p>
<p>Any <code>UNSET</code> values are not included.</p>
<div id="4056c9d1" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb228"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>asdict(bob)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>{'name': 'Bob', 'city': 'Unknown'}</code></pre>
</div>
</div>
<p>Set the optional <code>__flds__</code> parameter to customise the field list, and the optional <code>__skip__</code> parameter to skip some names.</p>
<div id="4281b968" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb230"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CustomObj:</span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>): <span class="va">self</span>.a,<span class="va">self</span>.b,<span class="va">self</span>.c,<span class="va">self</span>.d <span class="op">=</span> <span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span></span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>    __flds__ <span class="op">=</span> [<span class="st">'a'</span>,<span class="st">'b'</span>,<span class="st">'c'</span>,<span class="st">'d'</span>]</span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>    __skip__ <span class="op">=</span> [<span class="st">'b'</span>]</span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a>obj <span class="op">=</span> CustomObj()</span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a>test_eq(asdict(obj), {<span class="st">'a'</span>: <span class="dv">1</span>, <span class="st">'c'</span>: <span class="dv">3</span>, <span class="st">'d'</span>: <span class="dv">4</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>To customise dict conversion behavior for a class, implement the <code>_asdict</code> method (this is used in the Python stdlib for named tuples).</p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L925" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="vars_pub" class="level3">
<h3 class="anchored" data-anchor-id="vars_pub">vars_pub</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb231"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> vars_pub(</span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>    x</span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Get public non-skipped vars</em></p>
<p>The <a href="https://fastcore.fast.ai/xtras.html#vars_pub"><code>vars_pub</code></a> function returns a list of public (non-underscore-prefixed) variable names from an object, excluding any names listed in the object’s optional <code>__skip__</code> attribute.</p>
<div id="177d649d" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb232"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> TestObj:</span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>): <span class="va">self</span>.pub_attr,<span class="va">self</span>._priv_attr,<span class="va">self</span>.another_pub,<span class="va">self</span>.skip_me <span class="op">=</span> <span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span></span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>    __skip__ <span class="op">=</span> [<span class="st">'skip_me'</span>]</span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a>obj <span class="op">=</span> TestObj()</span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a>test_eq(vars_pub(obj), [<span class="st">'pub_attr'</span>, <span class="st">'another_pub'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Without <code>__skip__</code>, all pub vars are returned</p>
<div id="a858508f" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb233"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> SimpleObj:</span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>): <span class="va">self</span>.a,<span class="va">self</span>._b,<span class="va">self</span>.c <span class="op">=</span> <span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span></span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a>simple <span class="op">=</span> SimpleObj()</span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a>test_eq(vars_pub(simple), [<span class="st">'a'</span>, <span class="st">'c'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L931" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="is_typeddict" class="level3">
<h3 class="anchored" data-anchor-id="is_typeddict">is_typeddict</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb234"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_typeddict(</span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a>    cls:<span class="bu">type</span></span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a>)<span class="op">-&gt;</span><span class="bu">bool</span>:</span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Check if <code>cls</code> is a <code>TypedDict</code></em></p>
<div id="a94bb58f" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb235"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MyDict(TypedDict): name:<span class="bu">str</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> is_typeddict(MyDict)</span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="kw">not</span> is_typeddict({<span class="st">'a'</span>:<span class="dv">1</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L937" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="is_namedtuple" class="level3">
<h3 class="anchored" data-anchor-id="is_namedtuple">is_namedtuple</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb236"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> is_namedtuple(</span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a>    cls</span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em><code>True</code> if <code>cls</code> is a namedtuple type</em></p>
<div id="de67dbf3" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb237"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> is_namedtuple(namedtuple(<span class="st">'tst'</span>, [<span class="st">'a'</span>]))</span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="kw">not</span> is_namedtuple(<span class="bu">tuple</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L942" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="cachediter" class="level3">
<h3 class="anchored" data-anchor-id="cachediter">CachedIter</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb238"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> CachedIter(</span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a>    o</span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Cache the result returned by an iterator</em></p>
<div id="1fdc8e07" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb239"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f():</span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">yield</span> <span class="dv">1</span></span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">2</span></span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> CachedIter(f())</span>
<span id="cb239-6"><a href="#cb239-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> o <span class="kw">in</span> r: <span class="bu">print</span>(o)</span>
<span id="cb239-7"><a href="#cb239-7" aria-hidden="true" tabindex="-1"></a>r.value</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>1</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>2</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L950" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="cachedawaitable" class="level3">
<h3 class="anchored" data-anchor-id="cachedawaitable">CachedAwaitable</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb242"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> CachedAwaitable(</span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>    o</span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Cache the result from an awaitable</em></p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L958" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="reawaitable" class="level3">
<h3 class="anchored" data-anchor-id="reawaitable">reawaitable</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb243"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> reawaitable(</span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>    func:<span class="bu">callable</span></span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Wraps the result of an asynchronous function into an object which can be awaited more than once</em></p>
<p><code>CachedCoro</code> and <a href="https://fastcore.fast.ai/xtras.html#reawaitable"><code>reawaitable</code></a> are partly based on <a href="https://bugs.python.org/issue46622">python issue tracker</a> code from Serhiy Storchaka. They allow an awaitable to be called multiple times.</p>
<div id="a7336c4d" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb244"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="at">@reawaitable</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> fetch_data():</span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> asyncio.sleep(<span class="fl">0.1</span>)</span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"data"</span></span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> fetch_data()</span>
<span id="cb244-7"><a href="#cb244-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="cf">await</span> r)  <span class="co"># "data"</span></span>
<span id="cb244-8"><a href="#cb244-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="cf">await</span> r)  <span class="co"># "data" (no delay)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>data
data</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L965" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="flexicache" class="level3">
<h3 class="anchored" data-anchor-id="flexicache">flexicache</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb246"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> flexicache(</span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>    funcs:VAR_POSITIONAL, maxsize:<span class="bu">int</span><span class="op">=</span><span class="dv">128</span></span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Like <code>lru_cache</code>, but customisable with policy <code>funcs</code></em></p>
<p>This is a flexible lru cache function that you can pass a list of functions to. Those functions define the cache eviction policy. For instance, <a href="https://fastcore.fast.ai/xtras.html#time_policy"><code>time_policy</code></a> is provided for time-based cache eviction, and <a href="https://fastcore.fast.ai/xtras.html#mtime_policy"><code>mtime_policy</code></a> evicts based on a file’s modified-time changing. The policy functions are passed the last value that function returned was (initially <code>None</code>), and return a new value to indicate the cache has expired. When the cache expires, all functions are called with <code>None</code> to force getting new values.</p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L999" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="time_policy" class="level3">
<h3 class="anchored" data-anchor-id="time_policy">time_policy</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb247"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> time_policy(</span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a>    seconds</span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>A <a href="https://fastcore.fast.ai/xtras.html#flexicache"><code>flexicache</code></a> policy that expires cached items after <code>seconds</code> have passed</em></p>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L1007" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="mtime_policy" class="level3">
<h3 class="anchored" data-anchor-id="mtime_policy">mtime_policy</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb248"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mtime_policy(</span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>    filepath</span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>A <a href="https://fastcore.fast.ai/xtras.html#flexicache"><code>flexicache</code></a> policy that expires cached items after <code>filepath</code> modified-time changes</em></p>
<div id="e16e7b41" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb249"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="at">@flexicache</span>(time_policy(<span class="dv">10</span>), mtime_policy(<span class="st">'000_tour.ipynb'</span>))</span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cached_func(x, y): <span class="cf">return</span> x<span class="op">+</span>y</span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a>cached_func(<span class="dv">1</span>,<span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<pre><code>3</code></pre>
</div>
</div>
<div id="62e3eef3" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb251"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="at">@flexicache</span>(time_policy(<span class="dv">10</span>), mtime_policy(<span class="st">'000_tour.ipynb'</span>))</span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> cached_func(x, y): <span class="cf">return</span> x<span class="op">+</span>y</span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="cf">await</span> cached_func(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a><span class="cf">await</span> cached_func(<span class="dv">1</span>,<span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>3</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>3</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/AnswerDotAI/fastcore/blob/main/fastcore/xtras.py#L1015" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="timed_cache" class="level3">
<h3 class="anchored" data-anchor-id="timed_cache">timed_cache</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb254"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> timed_cache(</span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a>    seconds:<span class="bu">int</span><span class="op">=</span><span class="dv">60</span>, maxsize:<span class="bu">int</span><span class="op">=</span><span class="dv">128</span></span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><em>Like <code>lru_cache</code>, but also with time-based eviction</em></p>
<div id="4623e407" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb255"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="co"># demonstrate that flexicache is LRU</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="at">@flexicache</span>(maxsize<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cached_func(x): <span class="cf">return</span> time()</span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a>time_1 <span class="op">=</span> cached_func(<span class="dv">1</span>)</span>
<span id="cb255-6"><a href="#cb255-6" aria-hidden="true" tabindex="-1"></a>test_eq(time_1, cached_func(<span class="dv">1</span>))</span>
<span id="cb255-7"><a href="#cb255-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-8"><a href="#cb255-8" aria-hidden="true" tabindex="-1"></a>time_2 <span class="op">=</span> cached_func(<span class="dv">2</span>)</span>
<span id="cb255-9"><a href="#cb255-9" aria-hidden="true" tabindex="-1"></a>test_eq(time_1, cached_func(<span class="dv">1</span>))</span>
<span id="cb255-10"><a href="#cb255-10" aria-hidden="true" tabindex="-1"></a>test_eq(time_2, cached_func(<span class="dv">2</span>))</span>
<span id="cb255-11"><a href="#cb255-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-12"><a href="#cb255-12" aria-hidden="true" tabindex="-1"></a>time_3 <span class="op">=</span> cached_func(<span class="dv">3</span>) <span class="co"># Removes 1</span></span>
<span id="cb255-13"><a href="#cb255-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-14"><a href="#cb255-14" aria-hidden="true" tabindex="-1"></a>test_eq(time_2, cached_func(<span class="dv">2</span>)) <span class="co"># cache remains</span></span>
<span id="cb255-15"><a href="#cb255-15" aria-hidden="true" tabindex="-1"></a>test_eq(time_3, cached_func(<span class="dv">3</span>)) <span class="co"># cache remains</span></span>
<span id="cb255-16"><a href="#cb255-16" aria-hidden="true" tabindex="-1"></a>test_ne(time_1, cached_func(<span class="dv">1</span>)) <span class="co"># NEQ, removes 2</span></span>
<span id="cb255-17"><a href="#cb255-17" aria-hidden="true" tabindex="-1"></a>test_ne(time_2, cached_func(<span class="dv">2</span>))  <span class="co"># NEQ, removes 3</span></span>
<span id="cb255-18"><a href="#cb255-18" aria-hidden="true" tabindex="-1"></a>test_eq(cached_func(<span class="dv">1</span>), cached_func(<span class="dv">1</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This function is a small convenience wrapper for using <a href="https://fastcore.fast.ai/xtras.html#flexicache"><code>flexicache</code></a> with <a href="https://fastcore.fast.ai/xtras.html#time_policy"><code>time_policy</code></a>.</p>
<div id="0b594c8f" class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb256"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="at">@timed_cache</span>(seconds<span class="op">=</span><span class="fl">0.05</span>, maxsize<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cached_func(x): <span class="cf">return</span> x <span class="op">*</span> <span class="dv">2</span>, time()</span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a><span class="co"># basic caching</span></span>
<span id="cb256-5"><a href="#cb256-5" aria-hidden="true" tabindex="-1"></a>result1, time1 <span class="op">=</span> cached_func(<span class="dv">2</span>)</span>
<span id="cb256-6"><a href="#cb256-6" aria-hidden="true" tabindex="-1"></a>test_eq(result1, <span class="dv">4</span>)</span>
<span id="cb256-7"><a href="#cb256-7" aria-hidden="true" tabindex="-1"></a>sleep(<span class="fl">0.001</span>)</span>
<span id="cb256-8"><a href="#cb256-8" aria-hidden="true" tabindex="-1"></a>result2, time2 <span class="op">=</span> cached_func(<span class="dv">2</span>)</span>
<span id="cb256-9"><a href="#cb256-9" aria-hidden="true" tabindex="-1"></a>test_eq(result2, <span class="dv">4</span>)</span>
<span id="cb256-10"><a href="#cb256-10" aria-hidden="true" tabindex="-1"></a>test_eq(time1, time2)</span>
<span id="cb256-11"><a href="#cb256-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-12"><a href="#cb256-12" aria-hidden="true" tabindex="-1"></a><span class="co"># caching different values</span></span>
<span id="cb256-13"><a href="#cb256-13" aria-hidden="true" tabindex="-1"></a>result3, _ <span class="op">=</span> cached_func(<span class="dv">3</span>)</span>
<span id="cb256-14"><a href="#cb256-14" aria-hidden="true" tabindex="-1"></a>test_eq(result3, <span class="dv">6</span>)</span>
<span id="cb256-15"><a href="#cb256-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-16"><a href="#cb256-16" aria-hidden="true" tabindex="-1"></a><span class="co"># maxsize</span></span>
<span id="cb256-17"><a href="#cb256-17" aria-hidden="true" tabindex="-1"></a>_, time4 <span class="op">=</span> cached_func(<span class="dv">4</span>)</span>
<span id="cb256-18"><a href="#cb256-18" aria-hidden="true" tabindex="-1"></a>_, time2_new <span class="op">=</span> cached_func(<span class="dv">2</span>)</span>
<span id="cb256-19"><a href="#cb256-19" aria-hidden="true" tabindex="-1"></a>test_close(time2, time2_new, eps<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb256-20"><a href="#cb256-20" aria-hidden="true" tabindex="-1"></a>_, time3_new <span class="op">=</span> cached_func(<span class="dv">3</span>)</span>
<span id="cb256-21"><a href="#cb256-21" aria-hidden="true" tabindex="-1"></a>test_ne(time3_new, time())</span>
<span id="cb256-22"><a href="#cb256-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-23"><a href="#cb256-23" aria-hidden="true" tabindex="-1"></a><span class="co"># time expiration</span></span>
<span id="cb256-24"><a href="#cb256-24" aria-hidden="true" tabindex="-1"></a>sleep(<span class="fl">0.05</span>)</span>
<span id="cb256-25"><a href="#cb256-25" aria-hidden="true" tabindex="-1"></a>_, time4_new <span class="op">=</span> cached_func(<span class="dv">4</span>)</span>
<span id="cb256-26"><a href="#cb256-26" aria-hidden="true" tabindex="-1"></a>test_ne(time4_new, time())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/fastcore\.fast\.ai\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/AnswerDotAI/fastcore/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>